# Contract Risk Agent (åˆåŒé£é™©ç›‘æµ‹æ™ºèƒ½ä½“)
åŸºäºå¤§è¯­è¨€æ¨¡å‹çš„åˆåŒé£é™©ç›‘æµ‹æ™ºèƒ½ä½“
[![Python 3.10+](https://img.shields.io/badge/Python-3.10+-3776AB?logo=python&logoColor=white)](https://python.org)
[![Reflex](https://img.shields.io/badge/Reflex-Latest-000000?logo=reflex&logoColor=white)](https://reflex.dev)
[![FastAPI](https://img.shields.io/badge/FastAPI-0.115+-009688?logo=fastapi&logoColor=white)](https://fastapi.tiangolo.com)
[![LangChain](https://img.shields.io/badge/LangChain-0.3+-1C3C3C?logo=langchain)](https://langchain.com)
[![Ollama](https://img.shields.io/badge/Ollama-0.13+-000000?logo=ollama&logoColor=white)](https://ollama.ai)

---

##  é¡¹ç›®èƒŒæ™¯ä¸æ¦‚è¿°

åŸºäºå‚ç›´é¢†åŸŸå¤§æ¨¡å‹ç§ç±»ç¼ºä¹ï¼Œè€Œæ³•å¾‹è¡Œä¸šåœ¨åˆåŒå®¡æŸ¥æ–¹é¢éœ€è¦å¤§é‡çš„äººåŠ›ã€æ—¶é—´æˆæœ¬çš„èƒŒæ™¯ï¼ŒåŒæ—¶åˆåŒé¢†åŸŸå¯¹æ•°æ®éšç§æ€§æ•æ„Ÿï¼Œéš¾ä»¥é€šè¿‡è°ƒç”¨äº‘ç«¯çš„å¤§æ¨¡å‹é«˜é¢‘ç‡å¤§èŒƒå›´åœ°ä½¿ç”¨ã€‚æœ¬é¡¹ç›®ä½¿ç”¨äº†Qwen3:4b-instructè¿™ä¸€ä¾¿äºæœ¬åœ°éƒ¨ç½²çš„å°æ¨¡å‹ï¼Œæ—¨åœ¨é€šè¿‡è¶³å¤Ÿçš„å…ˆéªŒçŸ¥è¯†ä¸Promptçº¦æŸå¼•å¯¼ï¼Œèƒ½åœ¨ä¸€å®šç¨‹åº¦ä¸Šæå‡åˆåŒå®¡æŸ¥çš„æ•ˆç‡ã€‚

ç³»ç»Ÿé‡‡ç”¨ **"Rule-Guided + LLM-Reasoning"** (è§„åˆ™å¼•å¯¼ + å¤§æ¨¡å‹æ¨ç†) çš„æ··åˆæ¶æ„ï¼š
1. **è§„åˆ™å¼•æ“**ï¼šè¿™ä¸€éƒ¨åˆ†ä¸“å®¶çŸ¥è¯†è’¸é¦è‡ªGPT-5ï¼ŒGemini 3 Proç­‰ç›®å‰ä¸»æµé«˜æ€§èƒ½å¤§æ¨¡å‹ï¼Œç»è¿‡äººå·¥éªŒè¯å’Œæ¨¡å‹ä¹‹é—´çš„ç›¸äº’éªŒè¯ã€‚ç”¨äºæä¾›å›ºå®šç¨‹å¼ä¸‹æœ€ä¸ºå¸¸è§çš„åˆåŒé£é™©çš„è¾¨åˆ«ã€‚
2. **å¤§è¯­è¨€æ¨¡å‹æ¨ç†**ï¼šQwen3ï¼š4b-instructä½œä¸ºå°å‚æ•°æ¨¡å‹ï¼Œæ˜“äºæœ¬åœ°éƒ¨ç½²ï¼ŒåŒæ—¶ä¹Ÿæœ‰ç›¸å¯¹å……åˆ†çš„é¢„è®­ç»ƒçŸ¥è¯†ï¼Œå¯¹äºå·²ç»æä¾›å¥½å…ˆéªŒçŸ¥è¯†å’Œæ¨ç†æ¡†æ¶çš„åˆåŒé£é™©åˆ†æï¼Œèƒ½è¡¨ç°å‡ºæ¯”è¾ƒä¼˜è‰¯çš„æ€§èƒ½ã€‚
> âš ï¸ **å…è´£å£°æ˜**ï¼šæœ¬é¡¹ç›®ä¸ºå­¦æœ¯ç ”ç©¶ä¸æŠ€æœ¯éªŒè¯æ€§è´¨ï¼Œä»…ä¾›å­¦ä¹ äº¤æµï¼Œä¸æ„æˆä»»ä½•æ³•å¾‹å»ºè®®ã€‚åœ¨ç­¾ç½²é‡è¦åˆåŒæ—¶ï¼Œè¯·åŠ¡å¿…å’¨è¯¢ä¸“ä¸šå¾‹å¸ˆã€‚

---

## ç³»ç»Ÿæ¶æ„
ä¸ºäº†æä¾›æ›´ç°ä»£åŒ–çš„äº¤äº’ä½“éªŒå’Œæ›´ç¨³å®šçš„ç³»ç»Ÿæ¶æ„ï¼Œæœ¬é¡¹ç›®åœ¨å½“å‰ç‰ˆæœ¬ä½¿ç”¨äº† **Reflex** + **FastAPI**çš„æ¶æ„ã€‚

### ä¸»è¦ä¼˜ç‚¹
*   **äº¤äº’ä½“éªŒ**
    *   **åŒé¢æ¿å³æ—¶äº¤äº’**: é¦–é¡µé‡‡ç”¨ Split-View è®¾è®¡ï¼Œå·¦ä¾§æ“ä½œä¸å³ä¾§é¢„è§ˆå®æ—¶åŒæ­¥ï¼Œæ— éœ€é¢‘ç¹è·³è½¬ã€‚åˆ†æå®Œæˆåå³æ—¶è·³è½¬æŠ¥å‘Šé¡µé¢ã€‚
    *   **æ— ç¼å·¥ä½œæµ**: æ–‡ä»¶æ‹–æ‹½åè‡ªåŠ¨ä¸Šä¼ è§£æã€‚

*   **ç³»ç»Ÿæ¶æ„è§£è€¦**
    *   **å‰ç«¯**: ä½¿ç”¨ **Reflex** (åŸºäº React) æ„å»ºé«˜æ€§èƒ½å‰ç«¯ï¼ŒçŠ¶æ€ç®¡ç†æ›´åŠ å¯æ§ã€‚
    *   **åç«¯**: ç‹¬ç«‹å°è£… **FastAPI** æœåŠ¡å±‚ï¼Œè´Ÿè´£å¤„ç†è€—æ—¶çš„ LLM åˆ†æä¸æ£€ç´¢ä»»åŠ¡ï¼Œé€šè¿‡å¼‚æ­¥æ¥å£ä¸å‰ç«¯é€šä¿¡ã€‚

*   **æ¨ç†è¡¨ç°**
    *   **ä¸‰çº§é£é™©è¯„ä¼°ä½“ç³»**: æ”¯æŒ ğŸ”´é«˜/ğŸŸ ä¸­/ğŸŸ¢ä½ ä¸‰çº§é£é™©åˆ†ç±»ï¼ŒåŸºäºåˆæ³•æ€§ã€ç»æµæ€§ã€ç¡®å®šæ€§ä¸‰ç»´è¯„ä¼°ã€‚åˆ†çº§æ˜ç¡®ï¼Œå‡å°‘å› ä¸ºé£é™©åˆ’åˆ†ä¸æ˜æ˜¾å¯¼è‡´çš„æ­§ä¹‰ã€‚
    *   **æ·±åº¦åæ€æ¨¡å¼**: å¯¹é«˜/ä¸­é£é™©ç»“æœè§¦å‘å¤§æ¨¡å‹çš„äºŒæ¬¡å®¡æŸ¥ï¼Œäº§ç”Ÿã€Œç»´æŒ/è°ƒçº§/å­˜ç–‘ã€ä¸‰ç§ç»“è®ºï¼Œä¿è¯æœ€ç»ˆæ¨ç†æ•ˆæœè¶‹äºç¨³å®šï¼Œå¤šæ¬¡æ¨ç†ä¸€è‡´æ€§è¾ƒå¥½ã€‚è°ƒçº§é€»è¾‘æ”¯æŒåŒå‘è°ƒæ•´ã€‚
    *   **Top-K è§„åˆ™åŒ¹é…**: æ”¯æŒå¬å›å¤šä¸ªå€™é€‰è§„åˆ™ï¼ˆå¯é…ç½® top_kï¼‰ï¼Œä¸º LLM æä¾›æ›´ä¸°å¯Œçš„ä¸“å®¶çŸ¥è¯†ä¸Šä¸‹æ–‡ã€‚
    *   **é€æ˜åŒ–æ¨ç†**: åœ¨ç»ˆç«¯å®æ—¶è¾“å‡ºè§„åˆ™åŒ¹é…é“¾è·¯ï¼ˆåŒ¹é…è§„åˆ™ -> ç½®ä¿¡åº¦ -> æ³•å¾‹ä¾æ®ï¼‰ï¼Œè®© AI çš„å†³ç­–è¿‡ç¨‹"å¯è§£é‡Š"ã€‚

---

## æ ¸å¿ƒåŠŸèƒ½

### 1. å¤šæ ¼å¼è¾“å…¥
*   **å¤šæ ¼å¼æ”¯æŒ**: é›†æˆäº† `pdfplumber`, `python-docx`, `chardet` ç­‰åº“ï¼Œæ”¯æŒ PDFã€Wordã€TXT æ ¼å¼åˆåŒçš„ç²¾å‡†æ–‡æœ¬æå–ã€‚
*   **æ™ºèƒ½æ¸…æ´—**: è‡ªåŠ¨å»é™¤é¡µçœ‰é¡µè„šã€ä¹±ç å¹²æ‰°ï¼Œä¿ç•™æ–‡æ¡£æ ¸å¿ƒç»“æ„ã€‚

### 2. ç»“æ„åŒ–æ¡æ¬¾åˆ‡åˆ†
*   **æ­£åˆ™åˆ‡åˆ†å™¨**: åŸºäºæ³•å¾‹æ–‡æ¡£æ’ç‰ˆè§„èŒƒï¼Œåˆ©ç”¨æ­£åˆ™è¡¨è¾¾å¼ç²¾ç¡®è¯†åˆ«"ç¬¬ä¸€æ¡"ã€"1."ã€"1.1"ç­‰å±‚çº§ç»“æ„ã€‚
*   **ä¸­æ–‡æ•°å­—æ ‡å‡†åŒ–**: å†…ç½®ç®—æ³•å°†"ç¬¬ä¸€ç™¾äºŒåä¸‰æ¡"æ ‡å‡†åŒ–ä¸ºæ•°å­—ç´¢å¼•ï¼Œä¾¿äºåç»­å¤„ç†ã€‚

### 3. æ··åˆè§„åˆ™æ£€ç´¢å¼•æ“ (Hybrid Retrieval + Rerank)
*   **åŒè·¯å¬å›**:
    *   **è¯­ä¹‰æ£€ç´¢**: ä½¿ç”¨ `BGE-small-zh-v1.5` ç”Ÿæˆé«˜ç»´è¯­ä¹‰å‘é‡ï¼Œæ•è·"è¯­ä¹‰ç›¸ä¼¼"çš„é£é™©è§„åˆ™ã€‚
    *   **å…³é”®è¯åŒ¹é…**: ä½¿ç”¨ `BM25Okapi` + `jieba` åˆ†è¯ï¼Œæ•è·"å…³é”®è¯ç²¾ç¡®åŒ¹é…"çš„é£é™©è§„åˆ™ã€‚
*   **åŠ æƒèåˆ**: é‡‡ç”¨ `alpha * Dense + (1-alpha) * Sparse` åŠ æƒæ±‚å’Œç®—æ³•èåˆä¸¤è·¯ç»“æœï¼ˆé»˜è®¤ alpha=0.5ï¼‰ï¼Œé¿å…è¯­ä¹‰åŒ¹é…äº§ç”Ÿæ­§ä¹‰æˆ–è€…çº¯å…³é”®è¯åŒ¹é…è¿‡äºæ­»æ¿ã€‚
*   **Reranker é‡æ’åº**: ä½¿ç”¨ `BAAI/bge-reranker-v2-m3` å¯¹åˆæ­¥æ£€ç´¢ç»“æœè¿›è¡ŒäºŒæ¬¡ç²¾æ’ï¼Œè¿‡æ»¤ä½ç›¸å…³æ€§å€™é€‰ï¼ˆé»˜è®¤é˜ˆå€¼ 0.3ï¼‰ï¼Œæ˜¾è‘—æå‡å‚è€ƒä¿¡æ¯çš„è´¨é‡ã€‚
*   **Top-K å¤šè§„åˆ™å¬å›**: æ”¯æŒè¿”å›å¤šä¸ªè¶…è¿‡ç½®ä¿¡åº¦é˜ˆå€¼çš„å€™é€‰è§„åˆ™ï¼ˆé»˜è®¤ top_k=3ï¼‰ï¼Œæä¾›æ›´ä¸°å¯Œçš„ä¸Šä¸‹æ–‡ã€‚
*   **ç©ºä¸Šä¸‹æ–‡å®‰å…¨å…œåº•**: å½“ Reranker è¿‡æ»¤åå‚è€ƒä¿¡æ¯ä¸ºç©ºæ—¶ï¼Œç³»ç»Ÿå‘ LLM å‘é€æ˜ç¡®ä¿¡å·ï¼Œå¼•å¯¼æ¨¡å‹åŸºäºé€šç”¨æ³•å¾‹å¸¸è¯†åˆ¤æ–­ï¼Œé¿å…å¹»è§‰ã€‚

### 4. æ³•å¾‹ä¸ä¸“å®¶çŸ¥è¯†åº“
*   **é£é™©è§„åˆ™åº“**: å†…ç½® 120+ æ¡ç»è¿‡æ³•å¾‹ä¸“å®¶æ ‡æ³¨çš„å¸¸è§å•†ä¸šåˆåŒé£é™©ç‚¹ï¼ˆå¦‚ï¼šéœ¸ç‹æ¡æ¬¾ã€ä¸åˆç†è¿çº¦é‡‘ã€ç®¡è¾–æƒé™·é˜±ï¼‰ï¼Œä¸»è¦æ¶µç›–åŠ³åŠ¨ã€ä¹°å–ã€ç§Ÿèµä¸‰å¤§é¢†åŸŸï¼Œå¹¶ä¸”è¾…ä»¥é€šç”¨æ¡æ¬¾é£é™©ä¿è¯å…¨é¢ã€‚
*   **æ³•æ¡æ•°æ®åº“**: å†…ç½® SQLite æ•°æ®åº“ï¼Œå­˜å‚¨ã€Šæ°‘æ³•å…¸ã€‹ã€ã€ŠåŠ³åŠ¨åˆåŒæ³•ã€‹ç­‰æ ¸å¿ƒæ³•æ¡ï¼Œæ”¯æŒç²¾ç¡®å¼•ç”¨ã€‚

### 5. æ™ºèƒ½é¢„å¤„ç†ä¸é£é™©æ£€æµ‹
*   **å¼€åœºç™½è¿‡æ»¤**: è‡ªåŠ¨è¯†åˆ«åˆåŒå¼€å¤´çš„ç¨‹åºæ€§å†…å®¹ï¼ˆå¦‚"ç”²ä¹™åŒæ–¹åå•†ä¸€è‡´ç­¾è®¢æœ¬åˆåŒ"ï¼‰ï¼Œé¿å…è¯¯æŠ¥ã€‚
*   **è–ªèµ„ç»“æ„å¤±è¡¡æ£€æµ‹**: è‡ªåŠ¨è§£æè–ªèµ„æ¡æ¬¾ï¼Œå½“åº•è–ªå æ¯”ä½äº 40% æ—¶å‘å‡ºè­¦å‘Šï¼ˆé˜²æ­¢"é«˜ç»©æ•ˆä½åº•è–ª"é™·é˜±ï¼‰ã€‚

### 6. LLM æ·±åº¦æ¨ç†ä¸åæ€
*   **ä¸‰çº§é£é™©å®šä¹‰æ ‡å‡†**:
    *   **ğŸ”´ é«˜é£é™©**: è¿æ³•/æ— æ•ˆ/åŒå€èµ”å¿/æ ¸å¿ƒæƒç›Šå‰¥å¤ºï¼ˆæ¡æ¬¾æ˜¾å¼å¯¹æŠ—æ³•å¾‹å¼ºåˆ¶æ€§è§„å®šï¼‰ã€‚
    *   **ğŸŸ  ä¸­é£é™©**: æ¨¡ç³Š/æ­§ä¹‰/ä¸¾è¯å›°éš¾/éšå½¢æŸå¤±ï¼ˆæ¡æ¬¾æ²‰é»˜æˆ–æ¨¡ç³Šå¯¼è‡´è§£é‡Šä¸ç¡®å®šï¼‰ã€‚
    *   **ğŸŸ¢ ä½é£é™©**: æ³•å¾‹è‡ªåŠ¨è¡¥ä½/ç¨‹åºæ€§ç‘•ç–µï¼ˆæ³•å¾‹æœ‰å…œåº•æ¡æ¬¾ï¼Œæ— å®è´¨æŸå¤±ï¼‰ã€‚
*   **æç¤ºè¯å·¥ç¨‹**: å°†å¬å›çš„è§„åˆ™ã€æ³•æ¡ã€æ¡æ¬¾ä¸Šä¸‹æ–‡åŠ¨æ€æ³¨å…¥ Promptï¼Œçº¦æŸ LLM çš„ç”ŸæˆèŒƒå›´ã€‚
*   **æ·±åº¦åæ€**: å¯¹é«˜/ä¸­é£é™©è§¦å‘äºŒæ¬¡å®¡æŸ¥ï¼Œæ”¯æŒã€Œç»´æŒ/è°ƒçº§/å­˜ç–‘ã€ä¸‰ç§ç»“è®ºã€‚

### 7. é£é™©æŠ¥å‘Šå±•ç¤º
*   **ç»“æ„åŒ–è¾“å‡º**: ç”Ÿæˆ Markdown æ ¼å¼çš„è¯¦ç»†æŠ¥å‘Šï¼ŒåŒ…å«é£é™©ç­‰çº§ã€é£é™©ç‚¹æ‘˜è¦ã€æ³•æ¡ä¾æ®ã€ä¿®æ”¹å»ºè®®ã€‚
*   **å¯è§†åŒ–**: æä¾›é£é™©æ¦‚è§ˆä»ªè¡¨ç›˜ï¼Œæ”¯æŒæŒ‰é«˜/ä¸­/ä½é£é™©ç­‰çº§ç­›é€‰æŸ¥çœ‹ã€‚
*   **Word å¯¼å‡º**: å¯ä¸€é”®å¯¼å‡º Word æ ¼å¼æŠ¥å‘Šã€‚

---

## æŠ€æœ¯æ ˆ

| æ¨¡å— | æŠ€æœ¯é€‰å‹ | è¯´æ˜ |
| :--- | :--- | :--- |
| **å‰ç«¯æ¡†æ¶** | **Reflex** | å…¨æ ˆ Python Web æ¡†æ¶ï¼Œç¼–è¯‘ä¸º React SPAï¼Œæä¾›æè‡´äº¤äº’ä½“éªŒ |
| **åç«¯æœåŠ¡** | **FastAPI** | é«˜æ€§èƒ½å¼‚æ­¥ API æ¡†æ¶ï¼Œæ‰¿è½½æ ¸å¿ƒä¸šåŠ¡é€»è¾‘ |
| **ä»»åŠ¡é˜Ÿåˆ—** | **BackgroundTasks** | FastAPI åŸç”Ÿåå°ä»»åŠ¡ï¼Œå¤„ç†é•¿è€—æ—¶åˆ†æ |
| **å¤§æ¨¡å‹æ¡†æ¶** | **LangChain** | è´Ÿè´£ Prompt ç¼–æ’ã€æ¨¡å‹è°ƒç”¨æ¥å£å°è£… |
| **æœ¬åœ°æ¨ç†** | **Ollama** | è¿è¡Œ qwen3:4b-instruct / DeepSeek ç­‰å¼€æºå¤§æ¨¡å‹ |
| **LLM è°ƒç”¨** | **requests** | ç›´æ¥è°ƒç”¨ Ollama REST APIï¼Œé¿å… httpx å…¼å®¹æ€§é—®é¢˜ |
| **å‘é‡æ¨¡å‹** | **BGE-small-zh-v1.5** | ä¸­æ–‡è¯­ä¹‰å‘é‡è¡¨å¾ (Sentence-Transformers) |
| **é‡æ’åºæ¨¡å‹** | **BGE-Reranker-v2-m3** | å¯¹æ£€ç´¢ç»“æœè¿›è¡ŒäºŒæ¬¡ç²¾æ’ï¼Œè¿‡æ»¤ä½ç›¸å…³æ€§å€™é€‰ |
| **å…¨æ–‡æ£€ç´¢** | **Rank-BM25** | ä¼ ç»Ÿçš„è¯è¢‹æ¨¡å‹æ£€ç´¢ï¼Œä¿è¯å…³é”®è¯å‘½ä¸­ç‡ |
| **æ•°æ®å­˜å‚¨** | **SQLite** | è½»é‡çº§å…³ç³»å‹æ•°æ®åº“ï¼Œå­˜å‚¨æ³•æ¡ä¸å†å²è®°å½• |

---

## æ¶ˆèå®éªŒè¯„æµ‹ç³»ç»Ÿ

ç³»ç»Ÿå†…ç½®äº†å®Œæ•´çš„æ¶ˆèå®éªŒæ¡†æ¶ï¼Œç”¨äºé‡åŒ–å„ç»„ä»¶å¯¹æœ€ç»ˆæ•ˆæœçš„è´¡çŒ®ã€‚ä¸»è¦ç”¨äºé¡¹ç›®ç»§ç»­æ”¹è¿›çš„è¯„ä¼°ã€‚

### è¯„æµ‹æ¨¡å¼
ä»¥ä¸‹å››ç§æ¨¡å¼å‡è§„å®šäº†è¾“å‡ºæ ¼å¼ä¾¿äºè§£æã€‚æ— PromptæŒ‡çš„æ˜¯æ²¡æœ‰è§’è‰²å¼•å¯¼ã€å…ˆéªŒçŸ¥è¯†ç­‰çš„æ³¨å…¥ã€‚

| æ¨¡å¼ | æè¿° | ç»„ä»¶ |
|------|------|------|
| **Mode 1** | çº¯ LLM (Raw) | æ—  Prompt æ¨¡æ¿ï¼Œç›´æ¥è¾“å…¥ |
| **Mode 2** | åŸºç¡€ Prompt | æ ¼å¼åŒ– Promptï¼Œæ— è§„åˆ™å¼•æ“ |
| **Mode 3** | å½“å‰å·¥ä½œæµ | Prompt + è§„åˆ™å¼•æ“ + è‡ªåæ€ |
| **Mode 4** | ä¼˜åŒ–å·¥ä½œæµ | CoT Prompt + è§„åˆ™å¼•æ“ + è‡ªåæ€ |

### è¯„æµ‹æŒ‡æ ‡

| æŒ‡æ ‡ | æè¿° |
|------|------|
| **High-Risk F2-Score** | **æ ¸å¿ƒå®‰å…¨æŒ‡æ ‡**ã€‚F2 åˆ†æ•°ä¾§é‡ Recall (Î²=2)ï¼Œè´¯å½»"å®å¯é”™æ€ï¼Œä¸å¯æ¼è¿‡"çš„é£æ§åŸåˆ™ã€‚ |
| **Quadratic Kappa (QWK)** | **é€»è¾‘ä¸€è‡´æ€§æŒ‡æ ‡**ã€‚ä½¿ç”¨äºŒæ¬¡æ–¹æƒé‡æƒ©ç½šè·¨çº§é”™è¯¯ï¼Œè¡¡é‡æ¨¡å‹è¯„çº§é€»è¾‘çš„ç¨³å®šæ€§ã€‚ |
| **Weighted Accuracy** | **è½åœ°ä¸ä½“éªŒæŒ‡æ ‡**ã€‚é‡‡ç”¨éå¯¹ç§°åŠ æƒçŸ©é˜µï¼Œå¯¹é˜²å¾¡æ€§è¯¯åˆ¤ç»™äºˆéƒ¨åˆ†åˆ†æ•°ï¼Œå¯¹æ¼åˆ¤é›¶å®¹å¿ã€‚ |
| **Risk ID Precision** | **å¯ä¿¡åº¦æŒ‡æ ‡**ã€‚è¡¡é‡æ¨¡å‹æ˜¯å¦å¬å›äº†æ­£ç¡®çš„æ³•å¾‹/é£æ§è§„åˆ™ IDï¼Œè€Œéä»…ä»…è’™å¯¹ç­‰çº§ã€‚ |
| **High-Risk Leakage** | **é£æ§çº¢çº¿æŒ‡æ ‡**ã€‚ç»Ÿè®¡é«˜é£é™©æ¡æ¬¾è¢«è¯¯åˆ¤ä¸ºä¸­é£é™©çš„æ¯”ç‡ (High â†’ Medium)ã€‚ |
| **Hallucination Rate** | **å¹»è§‰ç‡**ã€‚ç»¼åˆæ£€æµ‹è¯æ®æ‘˜å½•ä¸æ³•æ¡å¼•ç”¨çš„çœŸå®æ€§ã€‚ |

### è¿è¡Œè¯„æµ‹

```bash
# å•æ¨¡å¼è¯„æµ‹
python evaluation/ablation_benchmark.py --mode 2 --limit 10

# å®Œæ•´æ¶ˆèå®éªŒ
python evaluation/ablation_benchmark.py --limit 20
```

> è¯¦ç»†æŠ€æœ¯æ–‡æ¡£è¯·è§ï¼š[TECHNICAL_DOCUMENTATION.md](./TECHNICAL_DOCUMENTATION.md)

ä»¥ä¸Šæ“ä½œå‡å¯é€šè¿‡start_reflex.pyè„šæœ¬å¯åŠ¨ååœ¨Webç«¯è¿›è¡Œã€‚

## å¿«é€Ÿå¼€å§‹-How to start

### 1. ç¯å¢ƒå‡†å¤‡
ç¡®ä¿å·²å®‰è£… Python 3.10+ å’Œ Gitã€‚

```bash
# å…‹éš†é¡¹ç›®ä»£ç 
git clone https://github.com/your-repo/contract-ai-agent.git
cd contract-ai-agent

# åˆ›å»ºå¹¶æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ
python -m venv .venv
# Windows
.venv\Scripts\activate
# Linux/Mac
source .venv/bin/activate
```

### 2. å®‰è£…ä¾èµ–
```bash
pip install -r requirements.txt
```

### 3. æ¨¡å‹å‡†å¤‡
#### A. LLM æ¨¡å‹ (Ollama)
ä¸‹è½½å¹¶å®‰è£… [Ollama](https://ollama.ai/)ï¼Œç„¶åæ‹‰å–æ¨¡å‹ï¼š
```bash
# é»˜è®¤æ¨¡å‹ï¼ˆæ¨èï¼‰
ollama pull qwen3:4b-instruct

# æˆ–è€…ä½¿ç”¨å¤§å‚æ•°æ¨¡å‹
ollama pull qwen2.5:14b
```

#### B. Embedding æ¨¡å‹
ä¸‹è½½ `BAAI/bge-small-zh-v1.5` æ¨¡å‹åˆ°æœ¬åœ°ï¼Œå¹¶åœ¨ `configs/config.yaml` ä¸­é…ç½®è·¯å¾„ï¼š
```yaml
embedding_config:
  model_path: "/path/to/your/bge-small-zh-v1.5"
```
*(æ³¨ï¼šä¹Ÿå¯ä»¥ç®€å•ä½¿ç”¨ HuggingFace è‡ªåŠ¨ä¸‹è½½ï¼Œæ— éœ€æ‰‹åŠ¨é…ç½®è·¯å¾„)*

### 4. å¯åŠ¨ç³»ç»Ÿ
ä½¿ç”¨é¡¹ç›®æ ¹ç›®å½•ä¸‹çš„å¯åŠ¨è„šæœ¬ï¼Œä¸€é”®æ‹‰èµ·åç«¯ API å’Œå‰ç«¯ç•Œé¢ï¼ˆå¯åŠ¨å®Œæˆåå¯è‡ªåŠ¨è·³è½¬ï¼‰ï¼š

```bash
python start_reflex.py
```

*   **è®¿é—®å‰ç«¯**: æ‰“å¼€æµè§ˆå™¨è®¿é—® `http://localhost:3000`
*   **æŸ¥çœ‹æ–‡æ¡£**: åç«¯ API æ–‡æ¡£ä½äº `http://localhost:8002/docs`

---

## æ ¸å¿ƒé…ç½®è¯´æ˜ (`configs/config.yaml`)

| é…ç½®é¡¹ | é»˜è®¤å€¼ | è¯´æ˜ |
| :--- | :--- | :--- |
| `system_config.max_concurrency` | `5` | å¹¶å‘åˆ†æçš„æ¡æ¬¾æ•°é‡ï¼Œæ˜¾å­˜è¶Šå¤§å¯è°ƒè¶Šå¤§ |
| `llm_config.model_name` | `qwen3:4b-instruct` | ä½¿ç”¨çš„ LLM æ¨¡å‹åç§°ï¼Œéœ€ä¸ Ollama ä¸€è‡´ |
| `llm_config.temperature` | `0` | æ¨¡å‹ç”Ÿæˆçš„éšæœºåº¦ï¼Œæ³•å¾‹åœºæ™¯å»ºè®®ä½å€¼ä»¥ä¿å‡†ç¡® |
| `hybrid_search_config.threshold` | `0.75` | è§„åˆ™åŒ¹é…çš„æœ€ä½ç½®ä¿¡åº¦é˜ˆå€¼ |
| `hybrid_search_config.alpha` | `0.65` | æ··åˆæ£€ç´¢æƒé‡ç³»æ•° (0.65 ä»£è¡¨ 65% è¯­ä¹‰ + 65% å…³é”®è¯) |
| `reranker_config.reflection_high_threshold` | `0.7` | è§¦å‘é«˜é£é™©åæ€çš„ç½®ä¿¡åº¦é˜ˆå€¼ |
| `reranker_config.reflection_low_threshold` | `0.5` | è§¦å‘ä½é£é™©åæ€çš„ç½®ä¿¡åº¦é˜ˆå€¼ |

---

## é¡¹ç›®ç»“æ„

```
Contract-AI-Agent/
â”œâ”€â”€ configs/                 # é…ç½®æ–‡ä»¶ (æ¨¡å‹å‚æ•°ã€è§„åˆ™é˜ˆå€¼)
â”‚   â”œâ”€â”€ config.yaml          # ä¸»é…ç½®
â”‚   â””â”€â”€ risk_standards.yaml  # é£é™©è¯„ä¼°æ ‡å‡†
â”œâ”€â”€ data/                    # æ•°æ®èµ„æº
â”‚   â””â”€â”€ databases/           # å‘é‡æ•°æ®åº“ä¸æ³•æ¡åº“
â”œâ”€â”€ docs/                    # æ–‡æ¡£ç›®å½•
â”‚   â”œâ”€â”€ weekly_reports/      # å‘¨æŠ¥
â”‚   â”œâ”€â”€ reports/             # Word æŠ¥å‘Š
â”‚   â””â”€â”€ *.md                 # æŠ€æœ¯æ–‡æ¡£
â”œâ”€â”€ evaluation/              # è¯„æµ‹æ¨¡å—
â”‚   â”œâ”€â”€ datasets/sources/    # è¯„æµ‹æºæ•°æ® (GENERAL/LABOR/LEASE/SALES)
â”‚   â”œâ”€â”€ results/             # è¯„æµ‹ç»“æœè¾“å‡º
â”‚   â”œâ”€â”€ ablation_benchmark.py  # æ¶ˆèå®éªŒä¸»è„šæœ¬
â”‚   â””â”€â”€ run_benchmark.py     # è¯„æµ‹è¿è¡Œå™¨
â”œâ”€â”€ reflex_web/              # Reflex å‰ç«¯
â”‚   â”œâ”€â”€ reflex_web/
â”‚   â”‚   â”œâ”€â”€ components/      # UI ç»„ä»¶ (å¡ç‰‡ã€ä¾§è¾¹æ ã€æŠ¥å‘Šè§†å›¾)
â”‚   â”‚   â”œâ”€â”€ state.py         # å‰ç«¯çŠ¶æ€ç®¡ç† (AppState)
â”‚   â”‚   â”œâ”€â”€ styles.py        # æ ·å¼å®šä¹‰ (Glassmorphism)
â”‚   â”‚   â””â”€â”€ reflex_web.py    # é¡µé¢å…¥å£ (Index, Report)
â”‚   â””â”€â”€ assets/              # é™æ€èµ„æºå›¾ç‰‡
â”œâ”€â”€ scripts/                 # å·¥å…·è„šæœ¬
â”‚   â”œâ”€â”€ import_processed_laws.py  # æ³•æ¡å¯¼å…¥
â”‚   â”œâ”€â”€ process_law_text.py       # æ³•æ¡å¤„ç†
â”‚   â””â”€â”€ test_llm.py               # LLM æµ‹è¯•
â”œâ”€â”€ src/                     # æ ¸å¿ƒæºç 
â”‚   â”œâ”€â”€ api/                 # FastAPI åç«¯æ¥å£
â”‚   â”œâ”€â”€ core/                # æ ¸å¿ƒä¸šåŠ¡é€»è¾‘
â”‚   â”‚   â”œâ”€â”€ engine.py        # åˆ†æä¸»å¼•æ“
â”‚   â”‚   â”œâ”€â”€ rule_engine.py   # è§„åˆ™åŒ¹é…å¼•æ“
â”‚   â”‚   â”œâ”€â”€ llm.py           # LLM è°ƒç”¨å°è£…
â”‚   â”‚   â”œâ”€â”€ hybrid_searcher.py # æ··åˆæ£€ç´¢å™¨
â”‚   â”‚   â”œâ”€â”€ reference_retriever.py # ç»Ÿä¸€æ£€ç´¢å™¨ (Top-K + Rerank)
â”‚   â”‚   â”œâ”€â”€ reranker.py      # BGE-Reranker é‡æ’åºæ¨¡å—
â”‚   â”‚   â”œâ”€â”€ prompts.py       # Prompt æ¨¡æ¿é›†ä¸­ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ output_parser.py # LLM è¾“å‡ºè§£æå™¨
â”‚   â”‚   â”œâ”€â”€ contract_classifier.py # åˆåŒç±»å‹åˆ†ç±»å™¨
â”‚   â”‚   â””â”€â”€ ollama_client.py # Ollama API å®¢æˆ·ç«¯
â”‚   â”œâ”€â”€ database/            # æ•°æ®åº“æ“ä½œ
â”‚   â””â”€â”€ utils/               # é€šç”¨å·¥å…·å‡½æ•°
â”œâ”€â”€ .gitignore
â”œâ”€â”€ README.md
â”œâ”€â”€ requirements.txt
â”œâ”€â”€ start_reflex.py          # å¯åŠ¨è„šæœ¬
â””â”€â”€ start_services.py        # æœåŠ¡å¯åŠ¨è„šæœ¬
```

---

## ç›¸å…³æ–‡æ¡£

| æ–‡æ¡£ | æè¿° |
|------|------|
| [TECHNICAL_DOCUMENTATION.md](./TECHNICAL_DOCUMENTATION.md) | å®Œæ•´æŠ€æœ¯æ¶æ„æ–‡æ¡£ |
| [evaluation/BENCHMARK_GENERATION_GUIDE.md](./evaluation/BENCHMARK_GENERATION_GUIDE.md) | è¯„æµ‹æ•°æ®é›†ç”ŸæˆæŒ‡å— |
