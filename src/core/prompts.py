"""
ç»Ÿä¸€çš„ Prompt æ¨¡æ¿ç®¡ç†æ¨¡å—

é›†ä¸­ç®¡ç†æ‰€æœ‰ç”¨äºåˆåŒå®¡æŸ¥çš„ Prompt æ¨¡æ¿ï¼Œä¾›ä»¥ä¸‹æ¨¡å—ç»Ÿä¸€è°ƒç”¨ï¼š
- engine.py (å®é™…å·¥ä½œæµ)
- ablation_benchmark.py (è¯„æµ‹è„šæœ¬)
- llm.py (LLM å®¢æˆ·ç«¯)
"""

# ============================================================================
# è¯„æµ‹æ¨¡å¼ Promptï¼ˆablation_benchmark.py ä½¿ç”¨ï¼‰
# ============================================================================

# æ¨¡å¼1ï¼šçº¯LLMï¼Œæœ€ç®€å•çš„è¾“å…¥
RAW_LLM_PROMPT = """è¯·åˆ†æä»¥ä¸‹åˆåŒæ¡æ¬¾æ˜¯å¦å­˜åœ¨é£é™©ï¼š

{clause}

è¯·æŒ‰ä»¥ä¸‹æ ¼å¼è¾“å‡ºï¼š
## é£é™©ï¼š[é£é™©ç®€è¿°]
- **ç­‰çº§**ï¼š[é«˜/ä¸­/ä½]
- **è¯æ®**ï¼š[è¯æ®æ‘˜å½•]
- **åˆ†æ**ï¼š[åˆ†æå†…å®¹]
- **æ³•æ¡**ï¼š[ç›¸å…³æ³•æ¡]
- **å»ºè®®**ï¼š[ä¿®æ”¹å»ºè®®]
"""

# æ¨¡å¼2ï¼šåŸºç¡€Promptï¼Œæœ‰æ ¼å¼çº¦æŸå’Œè§’è‰²å®šä¹‰ï¼Œä½†æ— è§„åˆ™å¼•æ“
BASIC_PROMPT = """ä½ æ˜¯ä¸€ä½ä¸“ä¸šçš„åˆåŒæ³•å¾‹é¡¾é—®ï¼Œè¯·åˆ†æä»¥ä¸‹åˆåŒæ¡æ¬¾æ˜¯å¦å­˜åœ¨é£é™©ã€‚

### æ¡æ¬¾åŸæ–‡
{clause}

### é£é™©å®šçº§æ ‡å‡†
1. **é«˜é£é™©**ï¼šæ¡æ¬¾æ˜æ˜¾è¿åæ³•å¾‹å¼ºåˆ¶æ€§è§„å®šï¼Œå¯¼è‡´æ— æ•ˆ/è¿æ³•/åŒå€èµ”å¿ã€‚
2. **ä¸­é£é™©**ï¼šæ¡æ¬¾è¡¨è¿°æ¨¡ç³Šã€å­˜åœ¨æ­§ä¹‰ï¼Œæˆ–æ˜¾å¤±å…¬å¹³ä½†æœªç›´æ¥è¿æ³•ã€‚
3. **ä½é£é™©**ï¼šæ¡æ¬¾å­˜åœ¨è½»å¾®ç‘•ç–µï¼Œä½†æ³•å¾‹æœ‰å…œåº•è§„å®šã€‚

### è¾“å‡ºè¦æ±‚
è¯·æŒ‰ä»¥ä¸‹Markdownæ ¼å¼è¾“å‡ºï¼ˆä¸è¦åŒ…å«```markdownæ ‡è®°ï¼‰ï¼š

## é£é™©ï¼š[é£é™©ç®€è¿°]
- **ç­‰çº§**ï¼š[é«˜/ä¸­/ä½]
- **è¯æ®**ï¼š[ä»æ¡æ¬¾åŸæ–‡ä¸­é€å­—æ‘˜å½•èƒ½è¯æ˜è¯¥é£é™©çš„å…³é”®è¯­å¥ï¼Œç”¨ã€Œã€æ‹¬èµ·æ¥]
- **åˆ†æ**ï¼š[è¯¦ç»†åˆ†æï¼Œ100å­—ä»¥å†…]
- **æ³•æ¡**ï¼š[ç›¸å…³æ³•æ¡ï¼Œè‹¥æ— åˆ™ç•™ç©º]
- **å»ºè®®**ï¼š[é’ˆå¯¹æ€§çš„ä¿®æ”¹å»ºè®®]
"""

# æ¨¡å¼3ï¼šå½“å‰å·¥ä½œæµPromptï¼ˆå¼•å…¥"æ‹’è¯†"æŒ‡ä»¤å’Œå®è´¨ç›¸å…³æ€§æ£€æŸ¥ï¼‰
CURRENT_WORKFLOW_PROMPT = """ä½ æ˜¯èµ„æ·±åˆåŒå¾‹å¸ˆã€‚è¯·åŸºäºã€å‚è€ƒä¿¡æ¯ã€‘å’Œã€é£é™©å®šçº§æ ‡å‡†ã€‘å¯¹ä»¥ä¸‹åˆåŒæ¡æ¬¾è¿›è¡Œåˆè§„å®¡æŸ¥ã€‚

### ğŸ“„ å¾…å®¡æ¡æ¬¾
{clause}

### ğŸ“š å‚è€ƒä¿¡æ¯ (å·²åŒ¹é…é£é™©åº“ - å¯èƒ½åŒ…å«ä¸ç›¸å…³ä¿¡æ¯)
{reference_info}

### âš–ï¸ é£é™©å®šçº§æ ‡å‡†
1. **é«˜é£é™©**ï¼šæ¡æ¬¾æ˜æ˜¾è¿åæ³•å¾‹å¼ºåˆ¶æ€§è§„å®šï¼ˆå¯¼è‡´æ— æ•ˆ/è¿æ³•ï¼‰ï¼›æˆ–è§¦å‘åéœ€æ”¯ä»˜åŒå€èµ”å¿/è¡Œæ”¿ç½šæ¬¾ï¼›æˆ–å¯¼è‡´æ ¸å¿ƒæƒç›Šï¼ˆå¦‚æ— å›ºå®šæœŸé™åˆåŒç­¾ç½²æƒï¼‰è¢«å‰¥å¤ºã€‚
2. **ä¸­é£é™©**ï¼šæ¡æ¬¾è¡¨è¿°æ¨¡ç³Šã€å­˜åœ¨è§£é‡Šæ­§ä¹‰ï¼›æˆ–ä¸¾è¯è´£ä»»å€’ç½®/è¿‡é«˜ï¼›æˆ–æ˜¾å¤±å…¬å¹³ä½†æœªç›´æ¥è¿æ³•ï¼ˆå±äºéšæ‚£ï¼‰ã€‚
3. **ä½é£é™©**ï¼šæ¡æ¬¾å­˜åœ¨è½»å¾®ç‘•ç–µï¼Œä½†æ³•å¾‹æœ‰å…œåº•è§„å®šï¼ˆè‡ªåŠ¨è¡¥ä½ï¼‰ï¼›æˆ–ä»…ä¸ºç¨‹åºæ€§ç¬”è¯¯ï¼Œä¸é€ æˆå®è´¨æŸå¤±ã€‚

âœ… æ­£ç¡®åˆ†æèŒƒä¾‹ï¼ˆå­¦ä¹ æ­¤æ‹’è¯†é€»è¾‘ï¼‰
æ¡æ¬¾ï¼š"ä¹™æ–¹æ¯æ—¥å·¥ä½œæ—¶é—´ä¸º8å°æ—¶ã€‚"
å‚è€ƒä¿¡æ¯ï¼š[é£é™©ç‚¹ï¼šåŠ ç­è´¹å‰¥å‰Š]...æœªæ”¯ä»˜åŠ ç­è´¹...
åˆ†æï¼šæ¡æ¬¾ä»…çº¦å®šæ ‡å‡†å·¥æ—¶ï¼Œæœªæ¶‰åŠåŠ ç­è´¹æ”¾å¼ƒæˆ–æ— å¿åŠ ç­ã€‚å‚è€ƒä¿¡æ¯çš„é£é™©é€»è¾‘ä¸æ¡æ¬¾å†…å®¹ä¸ç¬¦ã€‚
ç»“è®ºï¼šä½é£é™©ï¼ˆå¿½ç•¥å‚è€ƒä¿¡æ¯ï¼‰

### ğŸ“ å†™ä½œæŒ‡ä»¤
1. **ã€å…³é”®æ­¥éª¤ï¼šå‚è€ƒä¿¡æ¯çš„ç›¸å…³æ€§è¿‡æ»¤ã€‘**
   å‚è€ƒä¿¡æ¯ç”±æ£€ç´¢ç³»ç»Ÿæä¾›ï¼Œ**å¯èƒ½å­˜åœ¨é”™è¯¯æˆ–å™ªéŸ³**ã€‚åœ¨å¼•ç”¨å‰ï¼Œè¯·è¿›è¡Œä»¥ä¸‹åˆ¤æ–­ï¼š
   - **å®è´¨ç›¸å…³æ€§æ£€æŸ¥**ï¼šæ¡æ¬¾å†…å®¹çš„**å®é™…æ³•å¾‹åæœ**ï¼Œæ˜¯å¦çœŸçš„è§¦å‘äº†å‚è€ƒä¿¡æ¯ä¸­æè¿°çš„é£é™©é€»è¾‘ï¼Ÿ
   - **åå‘æ’é™¤**ï¼šå¦‚æœæ¡æ¬¾è¡¨è¿°æ˜¯åˆæ³•çš„ã€æ­£å¸¸çš„ï¼ˆå¦‚æ ‡å‡†å·¥æ—¶çº¦å®šï¼‰ï¼Œå³ä½¿å‚è€ƒä¿¡æ¯æç¤ºäº†é£é™©ï¼Œä¹Ÿå¿…é¡»**å¿½ç•¥å‚è€ƒä¿¡æ¯**ã€‚

   **åˆ¤å®šè§„åˆ™**ï¼š
   - è‹¥å‚è€ƒä¿¡æ¯ä¸ºç©ºæˆ–æ³¨æ˜â€œæ— â€ï¼Œè¯·åŸºäºã€ŠåŠ³åŠ¨åˆåŒæ³•ã€‹ç­‰é€šç”¨æ³•å¾‹å¸¸è¯†åˆ¤æ–­æ˜¯å¦å­˜åœ¨æ˜æ˜¾è¿æ³•ç‚¹ã€‚è‹¥æ— æ˜æ˜¾è¿æ³•ï¼Œåº”ç›´æ¥åˆ¤å®šä¸ºâ€œä½é£é™©â€ã€‚
   - è‹¥å‚è€ƒä¿¡æ¯ä¸æ¡æ¬¾**ä¸æ„æˆå®è´¨ç›¸å…³**ï¼Œè¯·ç›´æ¥å¿½ç•¥è¯¥å‚è€ƒä¿¡æ¯ï¼ŒåŸºäºé€šç”¨æ³•å¾‹å¸¸è¯†åˆ¤å®šï¼ˆé€šå¸¸ä¸º"ä½é£é™©"ï¼‰ã€‚
   - æ­¤æ—¶åœ¨"åˆ†æ"ä¸­æ³¨æ˜ï¼š"å‚è€ƒä¿¡æ¯ä¸æ¡æ¬¾å†…å®¹æ— å®è´¨å…³è”ï¼ŒåŸºäºæ¡æ¬¾åŸæ–‡åˆ¤æ–­ä¸ºæ— æ˜æ˜¾é£é™©ã€‚"

2. **ã€é£é™©å®šçº§ä¸åˆ†ææ‰§è¡Œã€‘**
   - **è‹¥ç¡®è®¤ç›¸å…³ä¸”æœ‰é£é™©**ï¼šæ‰©å†™å‚è€ƒä¿¡æ¯çš„ä¸“å®¶é€»è¾‘ã€‚
     - **é«˜é£é™©**ï¼šå¿…é¡»æ˜ç¡®æŒ‡å‡ºè¿åäº†å“ªæ¡æ³•å¾‹å¼ºåˆ¶æ€§è§„å®šï¼ˆå¦‚ã€ŠåŠ³åŠ¨åˆåŒæ³•ã€‹ç¬¬XXæ¡ï¼‰ï¼Œæˆ–æŒ‡æ˜å…·ä½“çš„ç»æµèµ”å¿åæœï¼ˆå¦‚2Nèµ”å¿ï¼‰ã€‚
     - **ä¸­é£é™©**ï¼šé‡ç‚¹åˆ†ææ¡æ¬¾çš„æ¨¡ç³Šæ€§ã€éšå½¢é™·é˜±æˆ–ç»´æƒæˆæœ¬ã€‚
   - **è‹¥åˆ¤å®šä¸ºä½é£é™©**ï¼šç®€è¿°ç†ç”±ï¼ˆå¦‚ç¬¦åˆæ³•å¾‹è§„å®šã€æœ‰å…œåº•æ¡æ¬¾ï¼‰ã€‚

3. **ã€ç©ºä¸Šä¸‹æ–‡å¤„ç†è§„åˆ™ï¼ˆå®‰å…¨å…œåº•ï¼‰ã€‘**
   è‹¥ç» Reranker è¿‡æ»¤åã€å‚è€ƒä¿¡æ¯ã€‘ä¸ºç©ºï¼š
   - **é»˜è®¤åˆ¤å®š**ï¼šåŸåˆ™ä¸Šåº”åˆ¤å®šä¸ºã€ğŸŸ¢ ä½é£é™©ã€‘ã€‚
   - **ä¾‹å¤–æƒ…å½¢**ï¼šä»…å½“æ¡æ¬¾å­˜åœ¨**æåº¦æ˜æ˜¾çš„å¸¸è¯†æ€§è¿æ³•**ï¼ˆä¾‹å¦‚ï¼šä¸æ”¯ä»˜å·¥èµ„ã€æ‰£æŠ¼èº«ä»½è¯ã€é™åˆ¶äººèº«è‡ªç”±ã€ç¼´çº³å…¥èŒæŠ¼é‡‘ï¼‰æ—¶ï¼Œå¯åˆ¤å®šä¸ºé«˜é£é™©ã€‚
   - **é˜²å¹»è§‰çº¦æŸ**ï¼šåœ¨æ­¤æƒ…å†µä¸‹ï¼Œåˆ†ææ—¶**ä¸¥ç¦å¼•ç”¨å…·ä½“çš„æ³•å¾‹æ¡æ–‡åºå·**ï¼ˆå¦‚"ç¬¬XXæ¡"ï¼‰ï¼Œä»…å¯æè¿°"è¿åæ³•å¾‹å¼ºåˆ¶æ€§è§„å®š"æˆ–"è¿åå…¬å¹³åŸåˆ™"ã€‚

4. **ã€æ ¼å¼è¦æ±‚ã€‘**
   ä¸¥ç¦è¾“å‡º JSONï¼Œä»…è¾“å‡ºä»¥ä¸‹ Markdown æ ¼å¼ï¼ˆä¸è¦åŒ…å« markdown æ ‡è®°ï¼‰ï¼š

## é£é™©ï¼š[é£é™©ç®€è¿°]
- **ç­‰çº§**ï¼š[é«˜/ä¸­/ä½] 
- **è¯æ®**ï¼š[ä»æ¡æ¬¾åŸæ–‡ä¸­é€å­—æ‘˜å½•èƒ½è¯æ˜è¯¥é£é™©çš„å…³é”®è¯­å¥ï¼Œç”¨ã€Œã€æ‹¬èµ·æ¥ï¼Œå¦‚æ— åˆ™å¡«"æ— "]
- **åˆ†æ**ï¼š[è¯¦ç»†åˆ†æï¼Œ100å­—ä»¥å†…]
- **æ³•æ¡**ï¼š[ç›´æ¥å¤è¿°å‚è€ƒä¿¡æ¯ä¸­çš„æ³•æ¡ï¼Œè‹¥æ— åˆ™ç•™ç©º]
- **å»ºè®®**ï¼š[é’ˆå¯¹æ€§çš„ä¿®æ”¹å»ºè®®]
---
"""

# æ¨¡å¼4ï¼šä¼˜åŒ–å·¥ä½œæµPromptï¼ˆSOTA èåˆç‰ˆ - å‰ç½®æ‹¦æˆªé€»è¾‘ï¼‰
OPTIMIZED_WORKFLOW_PROMPT = """ä½ æ˜¯èµ„æ·±åˆåŒå¾‹å¸ˆã€‚è¯·æŒ‰ç…§ä»¥ä¸‹ã€æ€ç»´é“¾æ­¥éª¤ã€‘è¿›è¡Œä¸¥è°¨çš„é£é™©æ¨ç†ã€‚

### æ¡æ¬¾åŸæ–‡
{clause}

### å‚è€ƒä¿¡æ¯ (å·²åŒ¹é…é£é™©åº“ - ä»…ä¾›å‚è€ƒ)
{reference_info}

### é£é™©å®šçº§æ ‡å‡†ï¼ˆè¯·ä¸¥æ ¼éµå®ˆï¼‰
1. **é«˜é£é™©**ï¼šæ¡æ¬¾æ˜æ˜¾è¿åæ³•å¾‹å¼ºåˆ¶æ€§è§„å®šï¼›æˆ–è§¦å‘åéœ€æ”¯ä»˜åŒå€èµ”å¿/è¡Œæ”¿ç½šæ¬¾ï¼›æˆ–å¯¼è‡´æ ¸å¿ƒæƒç›Šè¢«å‰¥å¤ºã€‚
2. **ä¸­é£é™©**ï¼šæ¡æ¬¾è¡¨è¿°æ¨¡ç³Šã€å­˜åœ¨è§£é‡Šæ­§ä¹‰ï¼›æˆ–æ˜¾å¤±å…¬å¹³ä½†æœªç›´æ¥è¿æ³•ã€‚
3. **ä½é£é™©**ï¼šæ¡æ¬¾ç¬¦åˆæ³•å¾‹è§„å®šï¼›æˆ–ä»…å­˜åœ¨è½»å¾®ç‘•ç–µä½†æ³•å¾‹æœ‰å…œåº•ï¼›æˆ–è¡¨è¿°ä¸­æ€§æ— æ˜æ˜¾é™·é˜±ã€‚

---

### åˆ†ææ­¥éª¤ï¼ˆChain-of-Thoughtï¼‰

**ç¬¬ä¸€æ­¥ï¼šæ£€æŸ¥â€œå‚è€ƒä¿¡æ¯â€çŠ¶æ€ï¼ˆé—¨æ§æœºåˆ¶ï¼‰**
è¯·é¦–å…ˆè§‚å¯Ÿã€å‚è€ƒä¿¡æ¯ã€‘çš„å†…å®¹ï¼š
- **æƒ…å†µ Aï¼šè‹¥å‚è€ƒä¿¡æ¯ä¸ºç©ºã€ä¸ºâ€œæ— â€ã€æˆ–æç¤ºæœªæ£€ç´¢åˆ°è§„åˆ™**
    * **è¿›å…¥ã€ç›²å®¡æ¨¡å¼ã€‘**ï¼šæ­¤æ—¶ä½ æ²¡æœ‰å¤–éƒ¨æ³•è§„æ”¯æŒã€‚
    * **åˆ¤å®šæ³•åˆ™**ï¼š
        1.  **é»˜è®¤åˆ¤ç½š**ï¼šç›´æ¥é”å®šä¸º **ã€ä½é£é™©ã€‘**ã€‚
        2.  **ç»å¯¹ç¦ä»¤**ï¼š**ä¸¥ç¦**å› ä¸ºâ€œè¡¨è¿°æ¨¡ç³Šâ€ã€â€œå¯èƒ½å­˜åœ¨éšæ‚£â€ã€â€œéœ¸ç‹æ¡æ¬¾å«Œç–‘â€ç­‰ç†ç”±åˆ¤å®šä¸ºã€ä¸­é£é™©ã€‘ã€‚åœ¨æ²¡æœ‰æ³•æ¡æ”¯æ’‘æ—¶ï¼Œè¿™äº›ä¸è¶³ä»¥å®šç½ªã€‚
        3.  **å”¯ä¸€ä¾‹å¤–ï¼ˆé«˜é£é™©ï¼‰**ï¼šä»…å½“æ¡æ¬¾åŒ…å«**æ— éœ€æ³•æ¡ä¹Ÿèƒ½è¯†åˆ«çš„æ¶æ€§è¿è§„**ï¼ˆå¦‚ï¼šé™åˆ¶äººèº«è‡ªç”±ã€æ‰£æŠ¼èº«ä»½è¯ã€æ˜ç¡®å†™æ˜â€œä¸æ”¯ä»˜å·¥èµ„â€ï¼‰æ—¶ï¼Œæ‰å¯è¶Šçº§åˆ¤ä¸ºã€é«˜é£é™©ã€‘ã€‚
    * **ç»“æŸæ¨ç†**ï¼šç›´æ¥è·³è½¬åˆ°è¾“å‡ºç¯èŠ‚ï¼Œä¸è¦æ‰§è¡Œåç»­æ­¥éª¤ã€‚

- **æƒ…å†µ Bï¼šè‹¥å‚è€ƒä¿¡æ¯ä¸ä¸ºç©ºï¼ˆå­˜åœ¨å…·ä½“è§„åˆ™ï¼‰**
    * **è¿›å…¥ã€æ ¡éªŒæ¨¡å¼ã€‘**ï¼šç»§ç»­æ‰§è¡Œç¬¬äºŒæ­¥å’Œç¬¬ä¸‰æ­¥ã€‚

**ç¬¬äºŒæ­¥ï¼šå‚è€ƒä¿¡æ¯â€œç‰¹å¼‚æ€§â€ç­›é€‰ï¼ˆä»…æƒ…å†µ B æ‰§è¡Œï¼‰**
- **è§„åˆ™Aï¼ˆæ•°å­—/äº‹å®æŠ—è¾©ï¼‰**ï¼šå¦‚æœæ¡æ¬¾åŸæ–‡åŒ…å«**å…·ä½“çš„æ•°å­—ã€æ—¥æœŸã€åœ°ç‚¹**ï¼Œä¸”ç¬¦åˆæ³•å¾‹å¸¸è¯†ï¼Œ**å¿…é¡»å¿½ç•¥å‚è€ƒä¿¡æ¯ä¸­çš„é£é™©æç¤º**ï¼Œåˆ¤ä¸ºã€ä½é£é™©ã€‘ã€‚
- **è§„åˆ™Bï¼ˆæ¨¡ç³Šæ€§é‡‡çº³ï¼‰**ï¼šå¦‚æœæ¡æ¬¾åŸæ–‡**æ²¡æœ‰å…·ä½“æ ‡å‡†**ï¼Œä¸”å‚è€ƒä¿¡æ¯æç¤ºäº†æ½œåœ¨é£é™©ï¼Œ**åº”å½“é‡‡çº³å‚è€ƒä¿¡æ¯**ã€‚

**ç¬¬ä¸‰æ­¥ï¼šé£é™©ç­‰çº§æœ€ç»ˆè£å®šï¼ˆä»…æƒ…å†µ B æ‰§è¡Œï¼‰**
åŸºäºç­›é€‰åçš„å‚è€ƒä¿¡æ¯è¿›è¡Œå®šçº§ï¼š
1.  ğŸ”´ **é«˜é£é™©**ï¼šå†…å®¹å®è´¨æ€§è¿æ³•ï¼Œæˆ–å‘½ä¸­å‚è€ƒä¿¡æ¯é«˜é£é™©ç‚¹ä¸”æ— äº‹å®æŠ—è¾©ã€‚
2.  ğŸŸ¡ **ä¸­é£é™©**ï¼šå‚è€ƒä¿¡æ¯æç¤ºé£é™©ï¼Œä½†æ¡æ¬¾æœªç›´æ¥è¿æ³•ï¼Œå±äºè§£é‡Šæƒæˆ–å…¬å¹³æ€§é—®é¢˜ã€‚
3.  ğŸŸ¢ **ä½é£é™©**ï¼šæœªå‘½ä¸­ä¸Šè¿°æƒ…å†µï¼Œæˆ–é€šè¿‡äº†ç‰¹å¼‚æ€§ç­›é€‰ã€‚

---

è¯·æŒ‰ä»¥ä¸‹Markdownæ ¼å¼è¾“å‡ºï¼š

## é£é™©ï¼š[é£é™©ç®€è¿°ï¼Œè‹¥æ— é£é™©è¯·å¡«"æ— æ˜æ˜¾é£é™©"]
- **ç­‰çº§**ï¼š[é«˜/ä¸­/ä½]
- **è¯æ®**ï¼š[**ä¸¥æ ¼çº¦æŸ**ï¼šå¿…é¡»ä»æ¡æ¬¾åŸæ–‡ä¸­**é€å­—æ‘˜å½•**å…³é”®è¯­å¥ï¼Œç”¨ã€Œã€æ‹¬èµ·æ¥ã€‚è‹¥åŸæ–‡ä¸­æ— æ˜ç¡®æ–‡å­—æ”¯æ’‘ï¼ˆä»…åŸºäºé€»è¾‘æˆ–å¸¸è¯†åˆ¤æ–­ï¼‰ï¼Œ**å¿…é¡»å¡«"æ— "**ã€‚ä¸¥ç¦è‡ªè¡Œç¼–é€ æˆ–æ”¹å†™åŸæ–‡ã€‚]
- **åˆ†æ**ï¼š[è¯¦ç»†åˆ†æã€‚**è‹¥å‚è€ƒä¿¡æ¯ä¸ºç©º**ï¼Œå¿…é¡»åœ¨åˆ†æä¸­å£°æ˜ï¼š"å› æ— å¤–éƒ¨è§„åˆ™æ”¯æŒï¼Œä¸”æœªè§¦çŠ¯æ˜¾æ€§çº¢çº¿ï¼Œä¾æ®é»˜è®¤å®‰å…¨åŸåˆ™åˆ¤ä¸ºä½é£é™©"ï¼ˆæˆ–è¯´æ˜å‘½ä¸­äº†å“ªä¸ªæ˜¾æ€§çº¢çº¿ï¼‰ã€‚]
- **æ³•æ¡**ï¼š[æ³•å¾‹ä¾æ®ï¼Œè‹¥åˆ¤å®šä¸ºä½é£é™©åˆ™ç•™ç©º]
- **å»ºè®®**ï¼š[ä¿®æ”¹å»ºè®®ï¼Œè‹¥ä½é£é™©å¯å¡«"æ— "]
"""


# ============================================================================
# ç”Ÿäº§ç¯å¢ƒ Promptï¼ˆllm.py / engine.py ä½¿ç”¨ï¼‰
# ============================================================================

# æ ¸å¿ƒåˆ†æ Promptï¼ˆä¸ CURRENT_WORKFLOW_PROMPT ç›¸åŒï¼Œä½†ä½¿ç”¨ clause_text å˜é‡åï¼‰
MERGED_SCAN_PROMPT = """
ä½ æ˜¯èµ„æ·±åˆåŒå¾‹å¸ˆã€‚è¯·åŸºäºã€å‚è€ƒä¿¡æ¯ã€‘å’Œã€é£é™©å®šçº§æ ‡å‡†ã€‘å¯¹ä»¥ä¸‹åˆåŒæ¡æ¬¾è¿›è¡Œåˆè§„å®¡æŸ¥ã€‚

### ğŸ“„ å¾…å®¡æ¡æ¬¾
{clause}

### ğŸ“š å‚è€ƒä¿¡æ¯ (å·²åŒ¹é…é£é™©åº“ - å¯èƒ½åŒ…å«ä¸ç›¸å…³ä¿¡æ¯)
{reference_info}

### âš–ï¸ é£é™©å®šçº§æ ‡å‡†
1. **é«˜é£é™©**ï¼šæ¡æ¬¾æ˜æ˜¾è¿åæ³•å¾‹å¼ºåˆ¶æ€§è§„å®šï¼ˆå¯¼è‡´æ— æ•ˆ/è¿æ³•ï¼‰ï¼›æˆ–è§¦å‘åéœ€æ”¯ä»˜åŒå€èµ”å¿/è¡Œæ”¿ç½šæ¬¾ï¼›æˆ–å¯¼è‡´æ ¸å¿ƒæƒç›Šï¼ˆå¦‚æ— å›ºå®šæœŸé™åˆåŒç­¾ç½²æƒï¼‰è¢«å‰¥å¤ºã€‚
2. **ä¸­é£é™©**ï¼šæ¡æ¬¾è¡¨è¿°æ¨¡ç³Šã€å­˜åœ¨è§£é‡Šæ­§ä¹‰ï¼›æˆ–ä¸¾è¯è´£ä»»å€’ç½®/è¿‡é«˜ï¼›æˆ–æ˜¾å¤±å…¬å¹³ä½†æœªç›´æ¥è¿æ³•ï¼ˆå±äºéšæ‚£ï¼‰ã€‚
3. **ä½é£é™©**ï¼šæ¡æ¬¾å­˜åœ¨è½»å¾®ç‘•ç–µï¼Œä½†æ³•å¾‹æœ‰å…œåº•è§„å®šï¼ˆè‡ªåŠ¨è¡¥ä½ï¼‰ï¼›æˆ–ä»…ä¸ºç¨‹åºæ€§ç¬”è¯¯ï¼Œä¸é€ æˆå®è´¨æŸå¤±ã€‚

âœ… æ­£ç¡®åˆ†æèŒƒä¾‹ï¼ˆå­¦ä¹ æ­¤æ‹’è¯†é€»è¾‘ï¼‰
æ¡æ¬¾ï¼š"ä¹™æ–¹æ¯æ—¥å·¥ä½œæ—¶é—´ä¸º8å°æ—¶ã€‚"
å‚è€ƒä¿¡æ¯ï¼š[é£é™©ç‚¹ï¼šåŠ ç­è´¹å‰¥å‰Š]...æœªæ”¯ä»˜åŠ ç­è´¹...
åˆ†æï¼šæ¡æ¬¾ä»…çº¦å®šæ ‡å‡†å·¥æ—¶ï¼Œæœªæ¶‰åŠåŠ ç­è´¹æ”¾å¼ƒæˆ–æ— å¿åŠ ç­ã€‚å‚è€ƒä¿¡æ¯çš„é£é™©é€»è¾‘ä¸æ¡æ¬¾å†…å®¹ä¸ç¬¦ã€‚
ç»“è®ºï¼šä½é£é™©ï¼ˆå¿½ç•¥å‚è€ƒä¿¡æ¯ï¼‰

### ğŸ“ å†™ä½œæŒ‡ä»¤
1. **ã€å…³é”®æ­¥éª¤ï¼šå‚è€ƒä¿¡æ¯çš„ç›¸å…³æ€§è¿‡æ»¤ã€‘**
   å‚è€ƒä¿¡æ¯ç”±æ£€ç´¢ç³»ç»Ÿæä¾›ï¼Œ**å¯èƒ½å­˜åœ¨é”™è¯¯æˆ–å™ªéŸ³**ã€‚åœ¨å¼•ç”¨å‰ï¼Œè¯·è¿›è¡Œä»¥ä¸‹åˆ¤æ–­ï¼š
   - **å®è´¨ç›¸å…³æ€§æ£€æŸ¥**ï¼šæ¡æ¬¾å†…å®¹çš„**å®é™…æ³•å¾‹åæœ**ï¼Œæ˜¯å¦çœŸçš„è§¦å‘äº†å‚è€ƒä¿¡æ¯ä¸­æè¿°çš„é£é™©é€»è¾‘ï¼Ÿ
   - **åå‘æ’é™¤**ï¼šå¦‚æœæ¡æ¬¾è¡¨è¿°æ˜¯åˆæ³•çš„ã€æ­£å¸¸çš„ï¼ˆå¦‚æ ‡å‡†å·¥æ—¶çº¦å®šï¼‰ï¼Œå³ä½¿å‚è€ƒä¿¡æ¯æç¤ºäº†é£é™©ï¼Œä¹Ÿå¿…é¡»**å¿½ç•¥å‚è€ƒä¿¡æ¯**ã€‚

   **åˆ¤å®šè§„åˆ™**ï¼š
   - è‹¥å‚è€ƒä¿¡æ¯ä¸ºç©ºæˆ–æ³¨æ˜â€œæ— â€ï¼Œè¯·åŸºäºã€ŠåŠ³åŠ¨åˆåŒæ³•ã€‹ç­‰é€šç”¨æ³•å¾‹å¸¸è¯†åˆ¤æ–­æ˜¯å¦å­˜åœ¨æ˜æ˜¾è¿æ³•ç‚¹ã€‚è‹¥æ— æ˜æ˜¾è¿æ³•ï¼Œåº”ç›´æ¥åˆ¤å®šä¸ºâ€œä½é£é™©â€ã€‚
   - è‹¥å‚è€ƒä¿¡æ¯ä¸æ¡æ¬¾**ä¸æ„æˆå®è´¨ç›¸å…³**ï¼Œè¯·ç›´æ¥å¿½ç•¥è¯¥å‚è€ƒä¿¡æ¯ï¼ŒåŸºäºé€šç”¨æ³•å¾‹å¸¸è¯†åˆ¤å®šï¼ˆé€šå¸¸ä¸º"ä½é£é™©"ï¼‰ã€‚
   - æ­¤æ—¶åœ¨"åˆ†æ"ä¸­æ³¨æ˜ï¼š"å‚è€ƒä¿¡æ¯ä¸æ¡æ¬¾å†…å®¹æ— å®è´¨å…³è”ï¼ŒåŸºäºæ¡æ¬¾åŸæ–‡åˆ¤æ–­ä¸ºæ— æ˜æ˜¾é£é™©ã€‚"

2. **ã€é£é™©å®šçº§ä¸åˆ†ææ‰§è¡Œã€‘**
   - **è‹¥ç¡®è®¤ç›¸å…³ä¸”æœ‰é£é™©**ï¼šæ‰©å†™å‚è€ƒä¿¡æ¯çš„ä¸“å®¶é€»è¾‘ã€‚
     - **é«˜é£é™©**ï¼šå¿…é¡»æ˜ç¡®æŒ‡å‡ºè¿åäº†å“ªæ¡æ³•å¾‹å¼ºåˆ¶æ€§è§„å®šï¼ˆå¦‚ã€ŠåŠ³åŠ¨åˆåŒæ³•ã€‹ç¬¬XXæ¡ï¼‰ï¼Œæˆ–æŒ‡æ˜å…·ä½“çš„ç»æµèµ”å¿åæœï¼ˆå¦‚2Nèµ”å¿ï¼‰ã€‚
     - **ä¸­é£é™©**ï¼šé‡ç‚¹åˆ†ææ¡æ¬¾çš„æ¨¡ç³Šæ€§ã€éšå½¢é™·é˜±æˆ–ç»´æƒæˆæœ¬ã€‚
   - **è‹¥åˆ¤å®šä¸ºä½é£é™©**ï¼šç®€è¿°ç†ç”±ï¼ˆå¦‚ç¬¦åˆæ³•å¾‹è§„å®šã€æœ‰å…œåº•æ¡æ¬¾ï¼‰ã€‚

3. **ã€ç©ºä¸Šä¸‹æ–‡å¤„ç†è§„åˆ™ï¼ˆå®‰å…¨å…œåº•ï¼‰ã€‘**
   è‹¥ç» Reranker è¿‡æ»¤åã€å‚è€ƒä¿¡æ¯ã€‘ä¸ºç©ºï¼š
   - **é»˜è®¤åˆ¤å®š**ï¼šåŸåˆ™ä¸Šåº”åˆ¤å®šä¸ºã€ğŸŸ¢ ä½é£é™©ã€‘ã€‚
   - **ä¾‹å¤–æƒ…å½¢**ï¼šä»…å½“æ¡æ¬¾å­˜åœ¨**æåº¦æ˜æ˜¾çš„å¸¸è¯†æ€§è¿æ³•**ï¼ˆä¾‹å¦‚ï¼šä¸æ”¯ä»˜å·¥èµ„ã€æ‰£æŠ¼èº«ä»½è¯ã€é™åˆ¶äººèº«è‡ªç”±ã€ç¼´çº³å…¥èŒæŠ¼é‡‘ï¼‰æ—¶ï¼Œå¯åˆ¤å®šä¸ºé«˜é£é™©ã€‚
   - **é˜²å¹»è§‰çº¦æŸ**ï¼šåœ¨æ­¤æƒ…å†µä¸‹ï¼Œåˆ†ææ—¶**ä¸¥ç¦å¼•ç”¨å…·ä½“çš„æ³•å¾‹æ¡æ–‡åºå·**ï¼ˆå¦‚"ç¬¬XXæ¡"ï¼‰ï¼Œä»…å¯æè¿°"è¿åæ³•å¾‹å¼ºåˆ¶æ€§è§„å®š"æˆ–"è¿åå…¬å¹³åŸåˆ™"ã€‚

4. **ã€æ ¼å¼è¦æ±‚ã€‘**
   ä¸¥ç¦è¾“å‡º JSONï¼Œä»…è¾“å‡ºä»¥ä¸‹ Markdown æ ¼å¼ï¼ˆä¸è¦åŒ…å« markdown æ ‡è®°ï¼‰ï¼š

## é£é™©ï¼š[é£é™©ç®€è¿°]
- **ç­‰çº§**ï¼š[é«˜/ä¸­/ä½] 
- **è¯æ®**ï¼š[ä»æ¡æ¬¾åŸæ–‡ä¸­é€å­—æ‘˜å½•èƒ½è¯æ˜è¯¥é£é™©çš„å…³é”®è¯­å¥ï¼Œç”¨ã€Œã€æ‹¬èµ·æ¥ï¼Œå¦‚æ— åˆ™å¡«"æ— "]
- **åˆ†æ**ï¼š[è¯¦ç»†åˆ†æï¼Œ100å­—ä»¥å†…]
- **æ³•æ¡**ï¼š[ç›´æ¥å¤è¿°å‚è€ƒä¿¡æ¯ä¸­çš„æ³•æ¡ï¼Œè‹¥æ— åˆ™ç•™ç©º]
- **å»ºè®®**ï¼š[é’ˆå¯¹æ€§çš„ä¿®æ”¹å»ºè®®]
---

"""

# è‡ªåæ€ Promptï¼ˆæœ€ç»ˆèåˆç‰ˆ - å”¤é†’æœºåˆ¶ï¼‰
SELF_REFLECTION_PROMPT = """
ä½ æ˜¯ä¸€åè´Ÿè´£ã€çº æ­£åˆå®¡æ–¹å‘æ€§é”™è¯¯ã€‘çš„åˆè§„å¤æ ¸å®¡è®¡å‘˜ã€‚
ä½ çš„èŒè´£ä¸æ˜¯é‡å¤åˆå®¡ï¼Œè€Œæ˜¯åœ¨åˆå®¡ç»“è®ºæ˜æ˜¾åç¦»é£é™©æœ¬è´¨æ—¶ï¼Œä¸»åŠ¨çº æ­£ã€‚

âš ï¸ è¡Œä¸ºå‡†åˆ™
- ç»´æŒé”™è¯¯åˆ¤æ–­ â‰  å®‰å…¨è¡Œä¸ºã€‚
- å½“åˆå®¡æ˜æ˜¾ä½ä¼°æˆ–é«˜ä¼°é£é™©æ—¶ï¼Œä¸æ”¹åˆ¤å±äºå¤±èŒã€‚
- æ”¹åˆ¤ä¸æ˜¯ä¾‹å¤–ï¼Œè€Œæ˜¯ä½ çš„èŒè´£ä¹‹ä¸€ã€‚

---

## ğŸ“‹ æ¡ˆä»¶æ¡£æ¡ˆ

ã€ç³»ç»Ÿä¿¡å·ã€‘
{system_signal}

ã€å¾…å¤æ ¸æ¡æ¬¾ã€‘
{clause_text}

ã€åˆå®¡ç»“è®ºã€‘
- é£é™©ç­‰çº§ï¼š{initial_risk_level}
- åˆ†ææ‘˜è¦ï¼š{analysis}

ã€å‚è€ƒä¿¡æ¯ã€‘
{reference_info}

---

## âš–ï¸ å¤æ ¸æ‰§è¡Œé€»è¾‘ï¼ˆå¿…é¡»æŒ‰é¡ºåºï¼‰

### Step 1ï¼šæ˜¯å¦å­˜åœ¨â€œé«˜é£é™©ä¿¡å·â€ï¼Ÿï¼ˆé«˜é£é™©ä¼˜å…ˆæ¥æºï¼‰

è‹¥æ¡æ¬¾å‡ºç°ä»¥ä¸‹ä»»ä¸€æƒ…å½¢ï¼Œ**é«˜åº¦å€¾å‘äºã€é«˜é£é™©ã€‘**ï¼š

- æ˜ç¡®è¿åæ³•å¾‹å¼ºåˆ¶æ€§è§„å®šï¼›
- æ˜ç¡®å…é™¤ä¸€æ–¹å› è¿æ³•æˆ–äººèº«æŸå®³çš„æ³•å®šè´£ä»»ï¼›
- èµ‹äºˆä¸€æ–¹æ— é™åˆ¶ã€æ— å¯¹ä»·çš„å•æ–¹æ ¸å¿ƒæƒåŠ›ï¼›
- æ ¸å¿ƒæƒåˆ©è¢«å®è´¨æ€§å‰¥å¤ºï¼ˆå³ä½¿æœªå†™æ˜è¿æ³•ï¼‰ã€‚

ğŸ‘‰ æŒ‡ä»¤ï¼š
- è‹¥åˆå®¡ä¸ºã€ä¸­ / ä½ã€‘ï¼Œä¸”ä½ è®¤ä¸ºé£é™©è¢«æ˜æ˜¾ä½ä¼° â†’ **å¿…é¡»å‡çº§ä¸ºé«˜é£é™©**ã€‚
- è‹¥ä»…å­˜åœ¨è½»å¾®ä¸å…¬å¹³ï¼Œä½†æœªè¾¾åˆ°ä¸Šè¿°ç¨‹åº¦ â†’ è¿›å…¥ Step 2ã€‚

---

### Step 2ï¼šæ˜¯å¦å±äºâ€œåˆè§„ä½†åº”æç¤ºçš„è´Ÿæ‹…â€ï¼Ÿï¼ˆä¸­é£é™©é”šç‚¹ï¼‰

è‹¥æ¡æ¬¾ä¸è¿æ³•ï¼Œä½†åœ¨æƒåˆ©ä¹‰åŠ¡ä¸Šæ˜æ˜¾å‘ä¸€æ–¹å€¾æ–œï¼Œ
å¯¹å¦ä¸€æ–¹å½¢æˆç°å®å‹åŠ›æˆ–è°ˆåˆ¤åŠ£åŠ¿ï¼Œå±äºï¼š

- åˆæ³•ä½†ä¸¥è‹›ï¼›
- åˆè§„ä½†å¯¹ä¹™æ–¹ä¸å‹å¥½ï¼›
- å¸æ³•ä¸Šå­˜åœ¨äº‰è®®ç©ºé—´ã€‚

ğŸ‘‰ æŒ‡ä»¤ï¼š
- åˆå®¡ä¸ºã€ä½é£é™©ã€‘ â†’ **å¿…é¡»å‡çº§ä¸ºä¸­é£é™©**ï¼›
- åˆå®¡ä¸ºã€é«˜é£é™©ã€‘ï¼Œä¸”æœªå‘½ä¸­ Step 1 â†’ **å¿…é¡»é™çº§ä¸ºä¸­é£é™©**ï¼›
- åˆå®¡ä¸ºã€ä¸­é£é™©ã€‘ï¼Œä¸”ä½ èƒ½æ¸…æ¥šè¯´æ˜è´Ÿæ‹…ç‚¹ â†’ ç»´æŒã€‚

---

### Step 3ï¼šæ˜¯å¦ç¡®å±æ— å®è´¨é£é™©ï¼Ÿ

ä»…å½“ä½ èƒ½ç¡®è®¤æ¡æ¬¾ï¼š
- ä¸å‰¥å¤ºæ ¸å¿ƒæƒåˆ©ï¼›
- ä¸é€ æˆå®è´¨æ€§è´Ÿæ‹…ï¼›
- ä»…ä¸ºä¸­æ€§æˆ–æƒ¯ä¾‹æ€§çº¦å®šï¼›

ğŸ‘‰ æ‰å…è®¸åˆ¤ä¸ºã€ä½é£é™©ã€‘ã€‚

---

## ğŸ“ è¾“å‡ºæ ¼å¼ï¼ˆä¸¥æ ¼ï¼‰

å®¡æŸ¥ç»“è®ºï¼š[ç»´æŒ / è°ƒæ•´]
æœ€ç»ˆé£é™©ç­‰çº§ï¼š[é«˜é£é™© / ä¸­é£é™© / ä½é£é™©]
ä¿®æ­£ä¾æ®ï¼š[ä¸€å¥è¯ï¼Œè¯´æ˜ä¸ºä½•åˆå®¡åé«˜æˆ–åä½]
"""


# ============================================================================
# ä¾¿æ·å‡½æ•°
# ============================================================================

def get_prompt_by_mode(mode: int, clause: str, reference_info: str = "") -> str:
    """
    æ ¹æ®è¯„æµ‹æ¨¡å¼è·å–å¯¹åº”çš„ Prompt
    
    Args:
        mode: 1=RAW_LLM, 2=BASIC, 3=CURRENT_WORKFLOW, 4=OPTIMIZED_WORKFLOW
        clause: æ¡æ¬¾åŸæ–‡
        reference_info: å‚è€ƒä¿¡æ¯ï¼ˆæ¨¡å¼3/4ä½¿ç”¨ï¼‰
    
    Returns:
        æ ¼å¼åŒ–åçš„ Prompt å­—ç¬¦ä¸²
    """
    if mode == 1:
        return RAW_LLM_PROMPT.format(clause=clause)
    elif mode == 2:
        return BASIC_PROMPT.format(clause=clause)
    elif mode == 3:
        return CURRENT_WORKFLOW_PROMPT.format(clause=clause, reference_info=reference_info or "æ— ")
    elif mode == 4:
        return OPTIMIZED_WORKFLOW_PROMPT.format(clause=clause, reference_info=reference_info or "æ— ")
    else:
        return RAW_LLM_PROMPT.format(clause=clause)
