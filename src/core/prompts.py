"""
ç»Ÿä¸€çš„ Prompt æ¨¡æ¿ç®¡ç†æ¨¡å—

é›†ä¸­ç®¡ç†æ‰€æœ‰ç”¨äºåˆåŒå®¡æŸ¥çš„ Prompt æ¨¡æ¿ï¼Œä¾›ä»¥ä¸‹æ¨¡å—ç»Ÿä¸€è°ƒç”¨ï¼š
- engine.py (å®é™…å·¥ä½œæµ)
- ablation_benchmark.py (è¯„æµ‹è„šæœ¬)
- llm.py (LLM å®¢æˆ·ç«¯)
"""

# ============================================================================
# è¯„æµ‹æ¨¡å¼ Promptï¼ˆablation_benchmark.py ä½¿ç”¨ï¼‰
# ============================================================================

# æ¨¡å¼1ï¼šçº¯LLMï¼Œæœ€ç®€å•çš„è¾“å…¥
RAW_LLM_PROMPT = """è¯·åˆ†æä»¥ä¸‹åˆåŒæ¡æ¬¾æ˜¯å¦å­˜åœ¨é£é™©ï¼š

{clause}

è¯·æŒ‰ä»¥ä¸‹æ ¼å¼è¾“å‡ºï¼š
## é£é™©ï¼š[é£é™©ç®€è¿°]
- **ç­‰çº§**ï¼š[é«˜/ä¸­/ä½]
- **è¯æ®**ï¼š[è¯æ®æ‘˜å½•]
- **åˆ†æ**ï¼š[åˆ†æå†…å®¹]
- **æ³•æ¡**ï¼š[ç›¸å…³æ³•æ¡]
- **å»ºè®®**ï¼š[ä¿®æ”¹å»ºè®®]
"""

# æ¨¡å¼2ï¼šåŸºç¡€Promptï¼Œæœ‰æ ¼å¼çº¦æŸå’Œè§’è‰²å®šä¹‰ï¼Œä½†æ— è§„åˆ™å¼•æ“
BASIC_PROMPT = """ä½ æ˜¯ä¸€ä½ä¸“ä¸šçš„åˆåŒæ³•å¾‹é¡¾é—®ï¼Œè¯·åˆ†æä»¥ä¸‹åˆåŒæ¡æ¬¾æ˜¯å¦å­˜åœ¨é£é™©ã€‚

### æ¡æ¬¾åŸæ–‡
{clause}

### é£é™©å®šçº§æ ‡å‡†
1. **é«˜é£é™©**ï¼šæ¡æ¬¾æ˜æ˜¾è¿åæ³•å¾‹å¼ºåˆ¶æ€§è§„å®šï¼Œå¯¼è‡´æ— æ•ˆ/è¿æ³•/åŒå€èµ”å¿ã€‚
2. **ä¸­é£é™©**ï¼šæ¡æ¬¾è¡¨è¿°æ¨¡ç³Šã€å­˜åœ¨æ­§ä¹‰ï¼Œæˆ–æ˜¾å¤±å…¬å¹³ä½†æœªç›´æ¥è¿æ³•ã€‚
3. **ä½é£é™©**ï¼šæ¡æ¬¾å­˜åœ¨è½»å¾®ç‘•ç–µï¼Œä½†æ³•å¾‹æœ‰å…œåº•è§„å®šã€‚

### è¾“å‡ºè¦æ±‚
è¯·æŒ‰ä»¥ä¸‹Markdownæ ¼å¼è¾“å‡ºï¼ˆä¸è¦åŒ…å«```markdownæ ‡è®°ï¼‰ï¼š

## é£é™©ï¼š[é£é™©ç®€è¿°]
- **ç­‰çº§**ï¼š[é«˜/ä¸­/ä½]
- **è¯æ®**ï¼š[ä»æ¡æ¬¾åŸæ–‡ä¸­é€å­—æ‘˜å½•èƒ½è¯æ˜è¯¥é£é™©çš„å…³é”®è¯­å¥ï¼Œç”¨ã€Œã€æ‹¬èµ·æ¥]
- **åˆ†æ**ï¼š[è¯¦ç»†åˆ†æï¼Œ100å­—ä»¥å†…]
- **æ³•æ¡**ï¼š[ç›¸å…³æ³•æ¡ï¼Œè‹¥æ— åˆ™ç•™ç©º]
- **å»ºè®®**ï¼š[é’ˆå¯¹æ€§çš„ä¿®æ”¹å»ºè®®]
"""

# æ¨¡å¼3ï¼šå½“å‰å·¥ä½œæµPromptï¼ˆå¼•å…¥"æ‹’è¯†"æŒ‡ä»¤å’Œå®è´¨ç›¸å…³æ€§æ£€æŸ¥ï¼‰
CURRENT_WORKFLOW_PROMPT = """ä½ æ˜¯èµ„æ·±åˆåŒå¾‹å¸ˆã€‚è¯·åŸºäºã€å‚è€ƒä¿¡æ¯ã€‘å’Œã€é£é™©å®šçº§æ ‡å‡†ã€‘å¯¹ä»¥ä¸‹åˆåŒæ¡æ¬¾è¿›è¡Œåˆè§„å®¡æŸ¥ã€‚

### ğŸ“„ å¾…å®¡æ¡æ¬¾
{clause}

### ğŸ“š å‚è€ƒä¿¡æ¯ (å·²åŒ¹é…é£é™©åº“ - å¯èƒ½åŒ…å«ä¸ç›¸å…³ä¿¡æ¯)
{reference_info}

### âš–ï¸ é£é™©å®šçº§æ ‡å‡†
1. **é«˜é£é™©**ï¼šæ¡æ¬¾æ˜æ˜¾è¿åæ³•å¾‹å¼ºåˆ¶æ€§è§„å®šï¼ˆå¯¼è‡´æ— æ•ˆ/è¿æ³•ï¼‰ï¼›æˆ–è§¦å‘åéœ€æ”¯ä»˜åŒå€èµ”å¿/è¡Œæ”¿ç½šæ¬¾ï¼›æˆ–å¯¼è‡´æ ¸å¿ƒæƒç›Šï¼ˆå¦‚æ— å›ºå®šæœŸé™åˆåŒç­¾ç½²æƒï¼‰è¢«å‰¥å¤ºã€‚
2. **ä¸­é£é™©**ï¼šæ¡æ¬¾è¡¨è¿°æ¨¡ç³Šã€å­˜åœ¨è§£é‡Šæ­§ä¹‰ï¼›æˆ–ä¸¾è¯è´£ä»»å€’ç½®/è¿‡é«˜ï¼›æˆ–æ˜¾å¤±å…¬å¹³ä½†æœªç›´æ¥è¿æ³•ï¼ˆå±äºéšæ‚£ï¼‰ã€‚
3. **ä½é£é™©**ï¼šæ¡æ¬¾å­˜åœ¨è½»å¾®ç‘•ç–µï¼Œä½†æ³•å¾‹æœ‰å…œåº•è§„å®šï¼ˆè‡ªåŠ¨è¡¥ä½ï¼‰ï¼›æˆ–ä»…ä¸ºç¨‹åºæ€§ç¬”è¯¯ï¼Œä¸é€ æˆå®è´¨æŸå¤±ã€‚

âœ… æ­£ç¡®åˆ†æèŒƒä¾‹ï¼ˆå­¦ä¹ æ­¤æ‹’è¯†é€»è¾‘ï¼‰
æ¡æ¬¾ï¼š"ä¹™æ–¹æ¯æ—¥å·¥ä½œæ—¶é—´ä¸º8å°æ—¶ã€‚"
å‚è€ƒä¿¡æ¯ï¼š[é£é™©ç‚¹ï¼šåŠ ç­è´¹å‰¥å‰Š]...æœªæ”¯ä»˜åŠ ç­è´¹...
åˆ†æï¼šæ¡æ¬¾ä»…çº¦å®šæ ‡å‡†å·¥æ—¶ï¼Œæœªæ¶‰åŠåŠ ç­è´¹æ”¾å¼ƒæˆ–æ— å¿åŠ ç­ã€‚å‚è€ƒä¿¡æ¯çš„é£é™©é€»è¾‘ä¸æ¡æ¬¾å†…å®¹ä¸ç¬¦ã€‚
ç»“è®ºï¼šä½é£é™©ï¼ˆå¿½ç•¥å‚è€ƒä¿¡æ¯ï¼‰

### ğŸ“ å†™ä½œæŒ‡ä»¤
1. **ã€å…³é”®æ­¥éª¤ï¼šå‚è€ƒä¿¡æ¯çš„ç›¸å…³æ€§è¿‡æ»¤ã€‘**
   å‚è€ƒä¿¡æ¯ç”±æ£€ç´¢ç³»ç»Ÿæä¾›ï¼Œ**å¯èƒ½å­˜åœ¨é”™è¯¯æˆ–å™ªéŸ³**ã€‚åœ¨å¼•ç”¨å‰ï¼Œè¯·è¿›è¡Œä»¥ä¸‹åˆ¤æ–­ï¼š
   - **å®è´¨ç›¸å…³æ€§æ£€æŸ¥**ï¼šæ¡æ¬¾å†…å®¹çš„**å®é™…æ³•å¾‹åæœ**ï¼Œæ˜¯å¦çœŸçš„è§¦å‘äº†å‚è€ƒä¿¡æ¯ä¸­æè¿°çš„é£é™©é€»è¾‘ï¼Ÿ
   - **åå‘æ’é™¤**ï¼šå¦‚æœæ¡æ¬¾è¡¨è¿°æ˜¯åˆæ³•çš„ã€æ­£å¸¸çš„ï¼ˆå¦‚æ ‡å‡†å·¥æ—¶çº¦å®šï¼‰ï¼Œå³ä½¿å‚è€ƒä¿¡æ¯æç¤ºäº†é£é™©ï¼Œä¹Ÿå¿…é¡»**å¿½ç•¥å‚è€ƒä¿¡æ¯**ã€‚

   **åˆ¤å®šè§„åˆ™**ï¼š
   - è‹¥å‚è€ƒä¿¡æ¯ä¸ºç©ºæˆ–æ³¨æ˜â€œæ— â€ï¼Œè¯·åŸºäºã€ŠåŠ³åŠ¨åˆåŒæ³•ã€‹ç­‰é€šç”¨æ³•å¾‹å¸¸è¯†åˆ¤æ–­æ˜¯å¦å­˜åœ¨æ˜æ˜¾è¿æ³•ç‚¹ã€‚è‹¥æ— æ˜æ˜¾è¿æ³•ï¼Œåº”ç›´æ¥åˆ¤å®šä¸ºâ€œä½é£é™©â€ã€‚
   - è‹¥å‚è€ƒä¿¡æ¯ä¸æ¡æ¬¾**ä¸æ„æˆå®è´¨ç›¸å…³**ï¼Œè¯·ç›´æ¥å¿½ç•¥è¯¥å‚è€ƒä¿¡æ¯ï¼ŒåŸºäºé€šç”¨æ³•å¾‹å¸¸è¯†åˆ¤å®šï¼ˆé€šå¸¸ä¸º"ä½é£é™©"ï¼‰ã€‚
   - æ­¤æ—¶åœ¨"åˆ†æ"ä¸­æ³¨æ˜ï¼š"å‚è€ƒä¿¡æ¯ä¸æ¡æ¬¾å†…å®¹æ— å®è´¨å…³è”ï¼ŒåŸºäºæ¡æ¬¾åŸæ–‡åˆ¤æ–­ä¸ºæ— æ˜æ˜¾é£é™©ã€‚"

2. **ã€é£é™©å®šçº§ä¸åˆ†ææ‰§è¡Œã€‘**
   - **è‹¥ç¡®è®¤ç›¸å…³ä¸”æœ‰é£é™©**ï¼šæ‰©å†™å‚è€ƒä¿¡æ¯çš„ä¸“å®¶é€»è¾‘ã€‚
     - **é«˜é£é™©**ï¼šå¿…é¡»æ˜ç¡®æŒ‡å‡ºè¿åäº†å“ªæ¡æ³•å¾‹å¼ºåˆ¶æ€§è§„å®šï¼ˆå¦‚ã€ŠåŠ³åŠ¨åˆåŒæ³•ã€‹ç¬¬XXæ¡ï¼‰ï¼Œæˆ–æŒ‡æ˜å…·ä½“çš„ç»æµèµ”å¿åæœï¼ˆå¦‚2Nèµ”å¿ï¼‰ã€‚
     - **ä¸­é£é™©**ï¼šé‡ç‚¹åˆ†ææ¡æ¬¾çš„æ¨¡ç³Šæ€§ã€éšå½¢é™·é˜±æˆ–ç»´æƒæˆæœ¬ã€‚
   - **è‹¥åˆ¤å®šä¸ºä½é£é™©**ï¼šç®€è¿°ç†ç”±ï¼ˆå¦‚ç¬¦åˆæ³•å¾‹è§„å®šã€æœ‰å…œåº•æ¡æ¬¾ï¼‰ã€‚

3. **ã€ç©ºä¸Šä¸‹æ–‡å¤„ç†è§„åˆ™ï¼ˆå®‰å…¨å…œåº•ï¼‰ã€‘**
   è‹¥ç» Reranker è¿‡æ»¤åã€å‚è€ƒä¿¡æ¯ã€‘ä¸ºç©ºï¼š
   - **é»˜è®¤åˆ¤å®š**ï¼šåŸåˆ™ä¸Šåº”åˆ¤å®šä¸ºã€ğŸŸ¢ ä½é£é™©ã€‘ã€‚
   - **ä¾‹å¤–æƒ…å½¢**ï¼šä»…å½“æ¡æ¬¾å­˜åœ¨**æåº¦æ˜æ˜¾çš„å¸¸è¯†æ€§è¿æ³•**ï¼ˆä¾‹å¦‚ï¼šä¸æ”¯ä»˜å·¥èµ„ã€æ‰£æŠ¼èº«ä»½è¯ã€é™åˆ¶äººèº«è‡ªç”±ã€ç¼´çº³å…¥èŒæŠ¼é‡‘ï¼‰æ—¶ï¼Œå¯åˆ¤å®šä¸ºé«˜é£é™©ã€‚
   - **é˜²å¹»è§‰çº¦æŸ**ï¼šåœ¨æ­¤æƒ…å†µä¸‹ï¼Œåˆ†ææ—¶**ä¸¥ç¦å¼•ç”¨å…·ä½“çš„æ³•å¾‹æ¡æ–‡åºå·**ï¼ˆå¦‚"ç¬¬XXæ¡"ï¼‰ï¼Œä»…å¯æè¿°"è¿åæ³•å¾‹å¼ºåˆ¶æ€§è§„å®š"æˆ–"è¿åå…¬å¹³åŸåˆ™"ã€‚

4. **ã€æ ¼å¼è¦æ±‚ã€‘**
   ä¸¥ç¦è¾“å‡º JSONï¼Œä»…è¾“å‡ºä»¥ä¸‹ Markdown æ ¼å¼ï¼ˆä¸è¦åŒ…å« markdown æ ‡è®°ï¼‰ï¼š

## é£é™©ï¼š[é£é™©ç®€è¿°]
- **ç­‰çº§**ï¼š[é«˜/ä¸­/ä½] 
- **è¯æ®**ï¼š[ä»æ¡æ¬¾åŸæ–‡ä¸­é€å­—æ‘˜å½•èƒ½è¯æ˜è¯¥é£é™©çš„å…³é”®è¯­å¥ï¼Œç”¨ã€Œã€æ‹¬èµ·æ¥ï¼Œå¦‚æ— åˆ™å¡«"æ— "]
- **åˆ†æ**ï¼š[è¯¦ç»†åˆ†æï¼Œ100å­—ä»¥å†…]
- **æ³•æ¡**ï¼š[ç›´æ¥å¤è¿°å‚è€ƒä¿¡æ¯ä¸­çš„æ³•æ¡ï¼Œè‹¥æ— åˆ™ç•™ç©º]
- **å»ºè®®**ï¼š[é’ˆå¯¹æ€§çš„ä¿®æ”¹å»ºè®®]
---
"""

# æ¨¡å¼4ï¼šä¼˜åŒ–å·¥ä½œæµPromptï¼ˆå»æ•å›å½’ç‰ˆ - ä¿®å¤Kappaä½çš„é—®é¢˜ï¼‰
OPTIMIZED_WORKFLOW_PROMPT = """ä½ æ˜¯èµ„æ·±åˆåŒå¾‹å¸ˆã€‚è¯·æŒ‰ç…§ä»¥ä¸‹ã€æ€ç»´é“¾æ­¥éª¤ã€‘è¿›è¡Œä¸¥è°¨çš„é£é™©æ¨ç†ã€‚

### æ¡æ¬¾åŸæ–‡
{clause}

### å‚è€ƒä¿¡æ¯ (å·²åŒ¹é…é£é™©åº“ - ä»…ä¾›å‚è€ƒ)
{reference_info}

### é£é™©å®šçº§æ ‡å‡†
1. **é«˜é£é™©**ï¼šæ¡æ¬¾æ˜æ˜¾è¿åæ³•å¾‹å¼ºåˆ¶æ€§è§„å®šï¼ˆå¯¼è‡´æ— æ•ˆ/è¿æ³•ï¼‰ï¼›æˆ–è§¦å‘åéœ€æ”¯ä»˜åŒå€èµ”å¿/è¡Œæ”¿ç½šæ¬¾ï¼›æˆ–å¯¼è‡´æ ¸å¿ƒæƒç›Šè¢«å‰¥å¤ºã€‚
2. **ä¸­é£é™©**ï¼šæ¡æ¬¾è¡¨è¿°æ¨¡ç³Šã€å­˜åœ¨è§£é‡Šæ­§ä¹‰ï¼›æˆ–ä¸¾è¯è´£ä»»å€’ç½®/è¿‡é«˜ï¼›æˆ–æ˜¾å¤±å…¬å¹³ä½†æœªç›´æ¥è¿æ³•ã€‚
3. **ä½é£é™©**ï¼šæ¡æ¬¾ç¬¦åˆæ³•å¾‹è§„å®šï¼›æˆ–ä»…å­˜åœ¨è½»å¾®ç‘•ç–µä½†æ³•å¾‹æœ‰å…œåº•ï¼›æˆ–è¡¨è¿°ä¸­æ€§æ— æ˜æ˜¾é™·é˜±ã€‚

### åˆ†ææ­¥éª¤ï¼ˆChain-of-Thoughtï¼‰

**ç¬¬ä¸€æ­¥ï¼šå‚è€ƒä¿¡æ¯æ¯”å¯¹ï¼ˆæ’é™¤å™ªéŸ³ï¼‰**
- **ä»»åŠ¡**ï¼šåˆ¤æ–­å‚è€ƒä¿¡æ¯ä¸­æè¿°çš„é£é™©åœºæ™¯ï¼Œåœ¨æ¡æ¬¾åŸæ–‡ä¸­æ˜¯å¦çœŸå®å‘ç”Ÿï¼Ÿ
- **è§„åˆ™**ï¼š
  - å¦‚æœå‚è€ƒä¿¡æ¯æç¤ºäº†é£é™©ï¼ˆå¦‚â€œè¯•ç”¨æœŸè¿è§„â€ï¼‰ï¼Œä½†æ¡æ¬¾åŸæ–‡ä¸­çš„æ•°å­—/è¡¨è¿°å®Œå…¨åˆæ³•ï¼ˆå¦‚â€œè¯•ç”¨æœŸ3ä¸ªæœˆâ€ï¼‰ï¼Œ**è¯·ç›´æ¥å¿½ç•¥è¯¥å‚è€ƒä¿¡æ¯**ã€‚
  - åªæœ‰å½“æ¡æ¬¾åŸæ–‡**æ˜ç¡®å†™å‡º**äº†è¿è§„è¡Œä¸ºï¼Œæˆ–è€…å­˜åœ¨æ˜æ˜¾çš„å¯¹æŠ—æ€§è¡¨è¿°ï¼Œæ‰é‡‡çº³å‚è€ƒä¿¡æ¯ã€‚

**ç¬¬äºŒæ­¥ï¼šé£é™©ç­‰çº§æœ€ç»ˆè£å®šï¼ˆâš ï¸ ä¸¥æ ¼æ‰§è¡Œä¼˜å…ˆçº§ï¼‰**

1.  ğŸ”´ **ä¼˜å…ˆçº§ Iï¼šé«˜é£é™©ï¼ˆä¸€ç¥¨å¦å†³ï¼‰**
    - åªè¦æ¡æ¬¾å†…å®¹**è¿åæ³•å¾‹å¼ºåˆ¶æ€§è§„å®š**ï¼ˆå¦‚é™åˆ¶äººèº«è‡ªç”±ã€ä¸æ”¯ä»˜å·¥èµ„ã€å…é™¤æ³•å®šè´£ä»»ï¼‰ï¼Œæˆ–è€…**ç›´æ¥å¯¹æŠ—å‚è€ƒä¿¡æ¯ä¸­çš„é«˜é£é™©ç‚¹**ï¼Œ**å¿…é¡»ç›´æ¥åˆ¤å®šä¸ºã€é«˜é£é™©ã€‘**ã€‚
    - **æ³¨æ„**ï¼šè¿æ³•å°±æ˜¯é«˜é£é™©ã€‚ä¸è¦å› ä¸ºæ¡æ¬¾è¡¨è¿°ç®€å•å°±é™çº§ä¸ºä¸­é£é™©ã€‚

2.  ğŸŸ¢ **ä¼˜å…ˆçº§ IIï¼šä½é£é™©ï¼ˆé»˜è®¤å®‰å…¨åŸåˆ™ - æ ¸å¿ƒä¿®æ­£ç‚¹ï¼‰**
    - **åˆ¤å®šæ³•åˆ™**ï¼šå¦‚æœæ¡æ¬¾è¡¨è¿°ç®€çŸ­ã€å¸¸è§„ï¼ˆä¾‹å¦‚ä»…çº¦å®šäº†æ ‡å‡†å·¥æ—¶ã€æŒ‰æœˆè–ªèµ„ï¼‰ï¼Œæˆ–è€…æœªçº¦å®šå…·ä½“ç»†èŠ‚ï¼ˆå¦‚æ²¡å†™å…·ä½“å‘è–ªæ—¥ï¼‰ï¼Œè¿™å±äº**å•†ä¸šæƒ¯ä¾‹**ï¼Œæ³•å¾‹ä¼šè‡ªåŠ¨è¡¥ä½ã€‚
    - **å…³é”®æŒ‡ä»¤**ï¼š**â€œå†™å¾—ç®€å•â€ä¸ç­‰äºâ€œè¡¨è¿°æ¨¡ç³Šâ€**ã€‚é™¤éæ¡æ¬¾ä¸­æœ‰æ•…æ„ç»•å¼€æ³•å¾‹çš„æ–‡å­—æ¸¸æˆï¼Œå¦åˆ™â€œæœªçº¦å®šç»†èŠ‚â€ä¸€å¾‹è§†ä¸ºã€ä½é£é™©ã€‘ã€‚**ä¸¥ç¦å°†â€œæœªçº¦å®šæ¸…æ™°â€ç›²ç›®åˆ¤ä¸ºä¸­é£é™©ã€‚**

3.  ğŸŸ¡ **ä¼˜å…ˆçº§ IIIï¼šä¸­é£é™©ï¼ˆå…œåº•é€‰é¡¹ï¼‰**
    - ä»…å½“æ¡æ¬¾**æ—¢ä¸è¿æ³•ï¼Œä¹Ÿä¸ç®€å•**ï¼Œè€Œæ˜¯å­˜åœ¨**æ–‡å­—é™·é˜±**ï¼ˆå¦‚â€œè§£é‡Šæƒå½’å…¬å¸æ‰€æœ‰â€ã€â€œæ ¹æ®ç»è¥æƒ…å†µçµæ´»è°ƒæ•´â€ï¼‰æˆ–**æ˜æ˜¾çš„éœ¸ç‹æ¡æ¬¾å«Œç–‘**æ—¶ï¼Œæ‰åˆ¤å®šä¸ºã€ä¸­é£é™©ã€‘ã€‚

**ç¬¬ä¸‰æ­¥ï¼šç©ºä¸Šä¸‹æ–‡åŠå…œåº•åˆ¤å®š**
è‹¥å‚è€ƒä¿¡æ¯ä¸ºç©ºæˆ–è¢«å¿½ç•¥ï¼š
- **é»˜è®¤åˆ¤å®š**ï¼š**ç›´æ¥åˆ¤å®šä¸ºã€ä½é£é™©ã€‘**ã€‚
- **å”¯ä¸€ä¾‹å¤–**ï¼šé™¤éæ¡æ¬¾åŒ…å«**æç«¯çš„ã€ç»å¯¹è¿æ³•çš„å­—çœ¼**ï¼ˆä»…é™ï¼šé™åˆ¶äººèº«è‡ªç”±ã€æ‰£æŠ¼èº«ä»½è¯ã€æ˜ç¡®å†™æ˜â€œä¸æ”¯ä»˜å·¥èµ„â€ï¼‰ã€‚

è¯·æŒ‰ä»¥ä¸‹Markdownæ ¼å¼è¾“å‡ºï¼š

## é£é™©ï¼š[é£é™©ç®€è¿°ï¼Œè‹¥æ— é£é™©è¯·å¡«"æ— æ˜æ˜¾é£é™©"]
- **ç­‰çº§**ï¼š[é«˜/ä¸­/ä½]
- **è¯æ®**ï¼š[ä»æ¡æ¬¾åŸæ–‡ä¸­é€å­—æ‘˜å½•ï¼Œç”¨ã€Œã€æ‹¬èµ·æ¥ï¼Œä¸¥ç¦æé€ ã€‚è‹¥æ— é£é™©å¡«"æ— "]
- **åˆ†æ**ï¼š[è¯¦ç»†åˆ†æï¼Œ100å­—ä»¥å†…ã€‚**è‹¥å¿½ç•¥äº†å‚è€ƒä¿¡æ¯ï¼Œå¿…é¡»è¯´æ˜ç†ç”±**]
- **æ³•æ¡**ï¼š[æ³•å¾‹ä¾æ®ï¼Œè‹¥åˆ¤å®šä¸ºä½é£é™©åˆ™ç•™ç©º]
- **å»ºè®®**ï¼š[ä¿®æ”¹å»ºè®®ï¼Œè‹¥ä½é£é™©å¯å¡«"æ— "]
"""


# ============================================================================
# ç”Ÿäº§ç¯å¢ƒ Promptï¼ˆllm.py / engine.py ä½¿ç”¨ï¼‰
# ============================================================================

# æ ¸å¿ƒåˆ†æ Promptï¼ˆä¸ CURRENT_WORKFLOW_PROMPT ç›¸åŒï¼Œä½†ä½¿ç”¨ clause_text å˜é‡åï¼‰
MERGED_SCAN_PROMPT = """
ä½ æ˜¯èµ„æ·±åˆåŒå¾‹å¸ˆã€‚è¯·åŸºäºã€å‚è€ƒä¿¡æ¯ã€‘å’Œã€é£é™©å®šçº§æ ‡å‡†ã€‘å¯¹ä»¥ä¸‹åˆåŒæ¡æ¬¾è¿›è¡Œåˆè§„å®¡æŸ¥ã€‚

### ğŸ“„ å¾…å®¡æ¡æ¬¾
{clause}

### ğŸ“š å‚è€ƒä¿¡æ¯ (å·²åŒ¹é…é£é™©åº“ - å¯èƒ½åŒ…å«ä¸ç›¸å…³ä¿¡æ¯)
{reference_info}

### âš–ï¸ é£é™©å®šçº§æ ‡å‡†
1. **é«˜é£é™©**ï¼šæ¡æ¬¾æ˜æ˜¾è¿åæ³•å¾‹å¼ºåˆ¶æ€§è§„å®šï¼ˆå¯¼è‡´æ— æ•ˆ/è¿æ³•ï¼‰ï¼›æˆ–è§¦å‘åéœ€æ”¯ä»˜åŒå€èµ”å¿/è¡Œæ”¿ç½šæ¬¾ï¼›æˆ–å¯¼è‡´æ ¸å¿ƒæƒç›Šï¼ˆå¦‚æ— å›ºå®šæœŸé™åˆåŒç­¾ç½²æƒï¼‰è¢«å‰¥å¤ºã€‚
2. **ä¸­é£é™©**ï¼šæ¡æ¬¾è¡¨è¿°æ¨¡ç³Šã€å­˜åœ¨è§£é‡Šæ­§ä¹‰ï¼›æˆ–ä¸¾è¯è´£ä»»å€’ç½®/è¿‡é«˜ï¼›æˆ–æ˜¾å¤±å…¬å¹³ä½†æœªç›´æ¥è¿æ³•ï¼ˆå±äºéšæ‚£ï¼‰ã€‚
3. **ä½é£é™©**ï¼šæ¡æ¬¾å­˜åœ¨è½»å¾®ç‘•ç–µï¼Œä½†æ³•å¾‹æœ‰å…œåº•è§„å®šï¼ˆè‡ªåŠ¨è¡¥ä½ï¼‰ï¼›æˆ–ä»…ä¸ºç¨‹åºæ€§ç¬”è¯¯ï¼Œä¸é€ æˆå®è´¨æŸå¤±ã€‚

âœ… æ­£ç¡®åˆ†æèŒƒä¾‹ï¼ˆå­¦ä¹ æ­¤æ‹’è¯†é€»è¾‘ï¼‰
æ¡æ¬¾ï¼š"ä¹™æ–¹æ¯æ—¥å·¥ä½œæ—¶é—´ä¸º8å°æ—¶ã€‚"
å‚è€ƒä¿¡æ¯ï¼š[é£é™©ç‚¹ï¼šåŠ ç­è´¹å‰¥å‰Š]...æœªæ”¯ä»˜åŠ ç­è´¹...
åˆ†æï¼šæ¡æ¬¾ä»…çº¦å®šæ ‡å‡†å·¥æ—¶ï¼Œæœªæ¶‰åŠåŠ ç­è´¹æ”¾å¼ƒæˆ–æ— å¿åŠ ç­ã€‚å‚è€ƒä¿¡æ¯çš„é£é™©é€»è¾‘ä¸æ¡æ¬¾å†…å®¹ä¸ç¬¦ã€‚
ç»“è®ºï¼šä½é£é™©ï¼ˆå¿½ç•¥å‚è€ƒä¿¡æ¯ï¼‰

### ğŸ“ å†™ä½œæŒ‡ä»¤
1. **ã€å…³é”®æ­¥éª¤ï¼šå‚è€ƒä¿¡æ¯çš„ç›¸å…³æ€§è¿‡æ»¤ã€‘**
   å‚è€ƒä¿¡æ¯ç”±æ£€ç´¢ç³»ç»Ÿæä¾›ï¼Œ**å¯èƒ½å­˜åœ¨é”™è¯¯æˆ–å™ªéŸ³**ã€‚åœ¨å¼•ç”¨å‰ï¼Œè¯·è¿›è¡Œä»¥ä¸‹åˆ¤æ–­ï¼š
   - **å®è´¨ç›¸å…³æ€§æ£€æŸ¥**ï¼šæ¡æ¬¾å†…å®¹çš„**å®é™…æ³•å¾‹åæœ**ï¼Œæ˜¯å¦çœŸçš„è§¦å‘äº†å‚è€ƒä¿¡æ¯ä¸­æè¿°çš„é£é™©é€»è¾‘ï¼Ÿ
   - **åå‘æ’é™¤**ï¼šå¦‚æœæ¡æ¬¾è¡¨è¿°æ˜¯åˆæ³•çš„ã€æ­£å¸¸çš„ï¼ˆå¦‚æ ‡å‡†å·¥æ—¶çº¦å®šï¼‰ï¼Œå³ä½¿å‚è€ƒä¿¡æ¯æç¤ºäº†é£é™©ï¼Œä¹Ÿå¿…é¡»**å¿½ç•¥å‚è€ƒä¿¡æ¯**ã€‚

   **åˆ¤å®šè§„åˆ™**ï¼š
   - è‹¥å‚è€ƒä¿¡æ¯ä¸ºç©ºæˆ–æ³¨æ˜â€œæ— â€ï¼Œè¯·åŸºäºã€ŠåŠ³åŠ¨åˆåŒæ³•ã€‹ç­‰é€šç”¨æ³•å¾‹å¸¸è¯†åˆ¤æ–­æ˜¯å¦å­˜åœ¨æ˜æ˜¾è¿æ³•ç‚¹ã€‚è‹¥æ— æ˜æ˜¾è¿æ³•ï¼Œåº”ç›´æ¥åˆ¤å®šä¸ºâ€œä½é£é™©â€ã€‚
   - è‹¥å‚è€ƒä¿¡æ¯ä¸æ¡æ¬¾**ä¸æ„æˆå®è´¨ç›¸å…³**ï¼Œè¯·ç›´æ¥å¿½ç•¥è¯¥å‚è€ƒä¿¡æ¯ï¼ŒåŸºäºé€šç”¨æ³•å¾‹å¸¸è¯†åˆ¤å®šï¼ˆé€šå¸¸ä¸º"ä½é£é™©"ï¼‰ã€‚
   - æ­¤æ—¶åœ¨"åˆ†æ"ä¸­æ³¨æ˜ï¼š"å‚è€ƒä¿¡æ¯ä¸æ¡æ¬¾å†…å®¹æ— å®è´¨å…³è”ï¼ŒåŸºäºæ¡æ¬¾åŸæ–‡åˆ¤æ–­ä¸ºæ— æ˜æ˜¾é£é™©ã€‚"

2. **ã€é£é™©å®šçº§ä¸åˆ†ææ‰§è¡Œã€‘**
   - **è‹¥ç¡®è®¤ç›¸å…³ä¸”æœ‰é£é™©**ï¼šæ‰©å†™å‚è€ƒä¿¡æ¯çš„ä¸“å®¶é€»è¾‘ã€‚
     - **é«˜é£é™©**ï¼šå¿…é¡»æ˜ç¡®æŒ‡å‡ºè¿åäº†å“ªæ¡æ³•å¾‹å¼ºåˆ¶æ€§è§„å®šï¼ˆå¦‚ã€ŠåŠ³åŠ¨åˆåŒæ³•ã€‹ç¬¬XXæ¡ï¼‰ï¼Œæˆ–æŒ‡æ˜å…·ä½“çš„ç»æµèµ”å¿åæœï¼ˆå¦‚2Nèµ”å¿ï¼‰ã€‚
     - **ä¸­é£é™©**ï¼šé‡ç‚¹åˆ†ææ¡æ¬¾çš„æ¨¡ç³Šæ€§ã€éšå½¢é™·é˜±æˆ–ç»´æƒæˆæœ¬ã€‚
   - **è‹¥åˆ¤å®šä¸ºä½é£é™©**ï¼šç®€è¿°ç†ç”±ï¼ˆå¦‚ç¬¦åˆæ³•å¾‹è§„å®šã€æœ‰å…œåº•æ¡æ¬¾ï¼‰ã€‚

3. **ã€ç©ºä¸Šä¸‹æ–‡å¤„ç†è§„åˆ™ï¼ˆå®‰å…¨å…œåº•ï¼‰ã€‘**
   è‹¥ç» Reranker è¿‡æ»¤åã€å‚è€ƒä¿¡æ¯ã€‘ä¸ºç©ºï¼š
   - **é»˜è®¤åˆ¤å®š**ï¼šåŸåˆ™ä¸Šåº”åˆ¤å®šä¸ºã€ğŸŸ¢ ä½é£é™©ã€‘ã€‚
   - **ä¾‹å¤–æƒ…å½¢**ï¼šä»…å½“æ¡æ¬¾å­˜åœ¨**æåº¦æ˜æ˜¾çš„å¸¸è¯†æ€§è¿æ³•**ï¼ˆä¾‹å¦‚ï¼šä¸æ”¯ä»˜å·¥èµ„ã€æ‰£æŠ¼èº«ä»½è¯ã€é™åˆ¶äººèº«è‡ªç”±ã€ç¼´çº³å…¥èŒæŠ¼é‡‘ï¼‰æ—¶ï¼Œå¯åˆ¤å®šä¸ºé«˜é£é™©ã€‚
   - **é˜²å¹»è§‰çº¦æŸ**ï¼šåœ¨æ­¤æƒ…å†µä¸‹ï¼Œåˆ†ææ—¶**ä¸¥ç¦å¼•ç”¨å…·ä½“çš„æ³•å¾‹æ¡æ–‡åºå·**ï¼ˆå¦‚"ç¬¬XXæ¡"ï¼‰ï¼Œä»…å¯æè¿°"è¿åæ³•å¾‹å¼ºåˆ¶æ€§è§„å®š"æˆ–"è¿åå…¬å¹³åŸåˆ™"ã€‚

4. **ã€æ ¼å¼è¦æ±‚ã€‘**
   ä¸¥ç¦è¾“å‡º JSONï¼Œä»…è¾“å‡ºä»¥ä¸‹ Markdown æ ¼å¼ï¼ˆä¸è¦åŒ…å« markdown æ ‡è®°ï¼‰ï¼š

## é£é™©ï¼š[é£é™©ç®€è¿°]
- **ç­‰çº§**ï¼š[é«˜/ä¸­/ä½] 
- **è¯æ®**ï¼š[ä»æ¡æ¬¾åŸæ–‡ä¸­é€å­—æ‘˜å½•èƒ½è¯æ˜è¯¥é£é™©çš„å…³é”®è¯­å¥ï¼Œç”¨ã€Œã€æ‹¬èµ·æ¥ï¼Œå¦‚æ— åˆ™å¡«"æ— "]
- **åˆ†æ**ï¼š[è¯¦ç»†åˆ†æï¼Œ100å­—ä»¥å†…]
- **æ³•æ¡**ï¼š[ç›´æ¥å¤è¿°å‚è€ƒä¿¡æ¯ä¸­çš„æ³•æ¡ï¼Œè‹¥æ— åˆ™ç•™ç©º]
- **å»ºè®®**ï¼š[é’ˆå¯¹æ€§çš„ä¿®æ”¹å»ºè®®]
---
"""

# è‡ªåæ€ Promptï¼ˆç»ˆæç²¾ä¿®ç‰ˆï¼‰- ç”¨äº Mode 3 ç”Ÿäº§ç¯å¢ƒåŠ Mode 4 å¯¹ç…§å®éªŒ
SELF_REFLECTION_PROMPT = """
ä½ æ˜¯ä¸€ä¸ªèµ„æ·±æ³•å¾‹åˆè§„ä¸“å®¶ï¼ˆAudit Expertï¼‰ã€‚è¯·å¯¹ä»¥ä¸‹åˆåŒæ¡æ¬¾çš„ã€åˆæ­¥é£é™©åˆ†æã€‘è¿›è¡ŒäºŒå®¡ï¼Œçº æ­£å¯èƒ½çš„è¯¯åˆ¤ã€‚

### ğŸ“‹ å¾…å®¡ä¿¡æ¯
ã€æ¡æ¬¾åŸæ–‡ã€‘
{clause_text}

ã€åˆå®¡ç»“è®ºã€‘
- é£é™©ç­‰çº§ï¼š{risk_level}
- é£é™©ç®€è¿°ï¼š{risk_reason}
- è¯æ®æ‘˜å½•ï¼š{evidence}
- è¯¦ç»†åˆ†æï¼š{analysis}

---

### âš–ï¸ äºŒå®¡è£å†³åŸºå‡†ï¼ˆä½ çš„æ ¸å¿ƒé€»è¾‘ï¼‰

**1. ğŸ”´ å¿…é¡»ç»´æŒã€é«˜é£é™©ã€‘çš„çº¢çº¿ï¼ˆä¸€ç¥¨å¦å†³ï¼‰**
è‹¥æ¡æ¬¾æ¶‰åŠä»¥ä¸‹æƒ…å½¢ï¼Œ**æ— è®ºæ¡æ¬¾ä¸­æ˜¯å¦å†™äº†â€œè‡ªæ„¿â€ã€â€œåå•†ä¸€è‡´â€**ï¼Œå‡å±äºç»å¯¹è¿æ³•ï¼Œ**ä¸¥ç¦é™çº§**ï¼š
- **æ ¸å¿ƒæƒç›Šå‰¥å¤º**ï¼šæ”¾å¼ƒç¤¾ä¿ã€æ”¾å¼ƒåŠ ç­è´¹ã€æ”¾å¼ƒæ³•å®šä¼‘å‡ã€‚
- **èµ„é‡‘è§¦çº¢**ï¼šå…‹æ‰£/æ— æ•…æ‹–æ¬ å·¥èµ„ã€ä½äºæœ€ä½å·¥èµ„æ ‡å‡†ã€‚
- **äººèº«é™åˆ¶**ï¼šæ‰£æŠ¼è¯ä»¶ã€é™åˆ¶äººèº«è‡ªç”±ã€è¿æ³•çš„ç«ä¸šé™åˆ¶ã€‚
- **è¿çº¦é‡‘æ»¥ç”¨**ï¼šé™¤â€œä¸“é¡¹åŸ¹è®­â€å’Œâ€œç«ä¸šé™åˆ¶â€å¤–ï¼Œå‘å‘˜å·¥ç´¢å–è¿çº¦é‡‘ã€‚

**2. ğŸŸ¢ å¿…é¡»é™çº§ä¸ºã€ä½é£é™©ã€‘çš„æƒ…å½¢ï¼ˆæ²‰é»˜å³å®‰å…¨ï¼‰**
- **æ²‰é»˜/æœªçº¦å®š**ï¼šè‹¥åˆå®¡å› â€œæœªçº¦å®šç®¡è¾–åœ°â€ã€â€œæœªå†™å…·ä½“å‘è–ªæ—¥ï¼ˆä½†å†™äº†æŒ‰æœˆï¼‰â€ã€â€œæœªè¯¦è¿°ç¤¾ä¿åŸºæ•°â€è€Œåˆ¤é«˜/ä¸­é£é™©ï¼Œ**å¿…é¡»é™çº§ä¸ºã€ä½é£é™©ã€‘**ã€‚
- **æ³•ç†ä¾æ®**ï¼šæ³•å¾‹æœ‰è‡ªåŠ¨è¡¥ä½è§„åˆ™ï¼ˆå¦‚æœªçº¦å®šåœ°ç‚¹åˆ™é€‚ç”¨å±¥è¡Œåœ°æ³•å¾‹ï¼‰ï¼Œæ­¤ç±»â€œæ²‰é»˜â€ä¸æ„æˆé£é™©ã€‚

**3. ğŸŸ¡ åº”å½“é™çº§ä¸ºã€ä¸­é£é™©ã€‘çš„æƒ…å½¢ï¼ˆç‘•ç–µä½†åˆæ³•ï¼‰**
- **æ–‡å­—æ¸¸æˆ**ï¼šè¡¨è¿°æ¨¡ç³Šï¼ˆå¦‚â€œè§£é‡Šæƒå½’å…¬å¸â€ï¼‰ã€æµç¨‹ä¸é€æ˜ï¼Œä½†æœªç›´æ¥è§¦çŠ¯ä¸Šè¿°çº¢çº¿ã€‚
- **è½»å¾®éœ¸ç‹**ï¼šæ¡æ¬¾æ˜¾å¤±å…¬å¹³ï¼Œä½†å°šä¸è‡³äºè¿æ³•æ— æ•ˆã€‚

---

### ğŸ“š åˆ¤ä¾‹åº“ï¼ˆFew-Shot Learningï¼‰

**ã€èŒƒä¾‹ Aï¼šç¦æ­¢è¯¯é™çº§ã€‘**
- **æ¡æ¬¾**ï¼šâ€œå‘˜å·¥è‡ªæ„¿æ”¾å¼ƒç¼´çº³ç¤¾ä¿ï¼Œå…¬å¸æ¯æœˆå‘æ”¾500å…ƒè¡¥è´´ã€‚â€
- **åˆå®¡**ï¼šé«˜é£é™©ã€‚
- **äºŒå®¡ç»“è®º**ï¼š**[ç»´æŒ]**
- **ç†ç”±**ï¼šç¤¾ä¿å±äºå›½å®¶å¼ºåˆ¶ä¹‰åŠ¡ï¼Œä¸ªäººæ— æƒæ”¾å¼ƒï¼Œè¡¥è´´ä¸èƒ½å…é™¤è¿æ³•æ€§ï¼Œè§¦çŠ¯çº¢çº¿ã€‚

**ã€èŒƒä¾‹ Bï¼šæ²‰é»˜ç›´é™ä¸ºä½ã€‘**
- **æ¡æ¬¾**ï¼šâ€œåŒæ–¹å‘ç”Ÿäº‰è®®ï¼Œå¯å‘åŠ³åŠ¨äº‰è®®ä»²è£å§”å‘˜ä¼šç”³è¯·ä»²è£ã€‚â€ï¼ˆæœªçº¦å®šå…·ä½“å“ªä¸ªä»²è£å§”ï¼‰
- **åˆå®¡**ï¼šä¸­é£é™©ï¼ˆç†ç”±ï¼šçº¦å®šä¸æ˜ï¼‰ã€‚
- **äºŒå®¡ç»“è®º**ï¼š**[è°ƒçº§] ä¸­é£é™© -> ä½é£é™©**
- **ç†ç”±**ï¼šè™½æœªçº¦å®šå…·ä½“ä»²è£å§”ï¼Œä½†æ³•å¾‹ä¼šè‡ªåŠ¨é€‚ç”¨â€œåŠ³åŠ¨åˆåŒå±¥è¡Œåœ°â€ç®¡è¾–ã€‚æ­¤ä¸ºâ€œæ²‰é»˜â€ï¼Œéé£é™©ã€‚

**ã€èŒƒä¾‹ Cï¼šä¿®æ­£è¿‡åº¦è§£è¯»ã€‘**
- **æ¡æ¬¾**ï¼šâ€œå·¥èµ„äºæ¬¡æœˆå‘æ”¾ã€‚â€
- **åˆå®¡**ï¼šä¸­é£é™©ï¼ˆç†ç”±ï¼šæœªå†™å…·ä½“æ—¥æœŸï¼Œå­˜åœ¨æ‹–æ¬ éšæ‚£ï¼‰ã€‚
- **äºŒå®¡ç»“è®º**ï¼š**[è°ƒçº§] ä¸­é£é™© -> ä½é£é™©**
- **ç†ç”±**ï¼šä»…å†™â€œæ¬¡æœˆâ€å±äºå¸¸è§çš„ç®€æ˜“è¡¨è¿°ï¼Œåªè¦æœªæ˜ç¡®å†™â€œæ‹–å»¶æ”¯ä»˜â€ï¼Œåº”è§†ä¸ºç¬¦åˆå•†ä¸šæƒ¯ä¾‹ã€‚

---

### ğŸ“ è¾“å‡ºæŒ‡ä»¤
è¯·åŸºäºä¸Šè¿°åŸºå‡†è¿›è¡Œå®¡æŸ¥ï¼Œä»…è¾“å‡ºä»¥ä¸‹æ ¼å¼å†…å®¹ï¼š

å®¡æŸ¥ç»“è®ºï¼š[ç»´æŒ / è°ƒçº§]
ä¿®æ­£å»ºè®®ï¼š[è‹¥è°ƒçº§ï¼Œè¯·å†™å…·ä½“ç­‰çº§æµå‘ï¼Œå¦‚"ä¸­é£é™© -> ä½é£é™©"ï¼›è‹¥ç»´æŒï¼Œå¡«"æ— "]
ç†ç”±ï¼š[åŸºäºå®¡æŸ¥åŸºå‡†ç®€è¿°ç†ç”±ï¼Œ50å­—ä»¥å†…ï¼Œé‡ç‚¹è¯´æ˜æ˜¯è§¦çŠ¯çº¢çº¿è¿˜æ˜¯æ³•å¾‹è¡¥ä½]
"""


# ============================================================================
# ä¾¿æ·å‡½æ•°
# ============================================================================

def get_prompt_by_mode(mode: int, clause: str, reference_info: str = "") -> str:
    """
    æ ¹æ®è¯„æµ‹æ¨¡å¼è·å–å¯¹åº”çš„ Prompt
    
    Args:
        mode: 1=RAW_LLM, 2=BASIC, 3=CURRENT_WORKFLOW, 4=OPTIMIZED_WORKFLOW
        clause: æ¡æ¬¾åŸæ–‡
        reference_info: å‚è€ƒä¿¡æ¯ï¼ˆæ¨¡å¼3/4ä½¿ç”¨ï¼‰
    
    Returns:
        æ ¼å¼åŒ–åçš„ Prompt å­—ç¬¦ä¸²
    """
    if mode == 1:
        return RAW_LLM_PROMPT.format(clause=clause)
    elif mode == 2:
        return BASIC_PROMPT.format(clause=clause)
    elif mode == 3:
        return CURRENT_WORKFLOW_PROMPT.format(clause=clause, reference_info=reference_info or "æ— ")
    elif mode == 4:
        return OPTIMIZED_WORKFLOW_PROMPT.format(clause=clause, reference_info=reference_info or "æ— ")
    else:
        return RAW_LLM_PROMPT.format(clause=clause)
